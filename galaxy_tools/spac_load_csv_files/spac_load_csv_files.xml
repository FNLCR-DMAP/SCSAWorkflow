<tool id="spac_load_csv_files" name="Load CSV Files [SPAC] [DMAP]" version="1.0.0" profile="21.05">
        <description>Load CSV files from NIDAP dataset and combine them into a single pandas dataframe for downstream ...</description>
        
        <requirements>
            <container type="docker">nciccbr/spac:v1</container>
        </requirements>
        
        <environment_variables>
            <variable name="SPAC_PYTHON">python3</variable>
        </environment_variables>
        
        <command detect_errors="exit_code"><![CDATA[
            ## Create directory for CSV files
            mkdir -p csv_input_dir &&
            
            ## Copy CSV files to directory with original names
            #for $i, $csv_file in enumerate($CSV_Files)
                cp '${csv_file}' 'csv_input_dir/${csv_file.name}' &&
            #end for
            
            ## Ensure log file exists
            : > tool_stdout.txt &&
            
            ## Run the universal wrapper
            bash $__tool_directory__/run_spac_template.sh "$params_json" load_csv_files_with_config
        ]]></command>
        
        <configfiles>
            <!-- Galaxy serializes all inputs including hidden 'outputs' to this JSON -->
            <inputs name="params_json" filename="params.json" data_style="paths"/>
        </configfiles>
        
        <inputs>
            <param name="CSV_Files" type="data" format="csv,tabular" multiple="true"
                label="CSV Files" 
                help="Select the CSV files you want to load and combine."/>
            
            <param name="CSV_Files_Configuration" type="data" format="csv,tabular" 
                label="CSV Files Configuration" 
                help="Configuration table with file_name column and optional metadata columns."/>
            
            <param name="String_Columns" type="text" area="true" value="" 
                label="String Columns (Optional)" 
                help="Column names to treat as strings. Enter as comma-separated list or one per line."/>
            
            <!-- Hidden parameter to pass outputs specification -->
            <param name="outputs" type="hidden" value='{"DataFrames": "dataframe_folder"}'/>
        </inputs>
        
        <outputs>
            <!-- Single combined DataFrame produced by load_csv_files -->
            <data name="dataframe"
                format="tabular"
                from_work_dir="dataframe_folder/combined_dataframe.csv"
                label="${tool.name} on ${on_string}: DataFrame"/>            
            <data name="config_used"
                format="json"
                from_work_dir="config_used.json"
                label="${tool.name} on ${on_string}: Parameters Used"/>
            <data name="execution_log"
                format="txt"
                from_work_dir="tool_stdout.txt"
                label="${tool.name} on ${on_string}: Execution Log"/>
        </outputs>
        
        <help><![CDATA[
            **Load CSV Files [SPAC] [DMAP]**
            
            Load CSV files from NIDAP dataset and combine them into a single pandas dataframe for downstream processing. [GitHub Documentation](https://fnlcr-dmap.github.io/SCSAWorkflow/spac.html#spac.data_utils.combine_dfs) for further information.
            
            This tool is part of the SPAC (SPAtial single-Cell analysis) toolkit.
            
            **Special Notes for Load CSV Files:**
            - Select multiple CSV files to combine
            - Provide a configuration table with file_name column
            - Optionally specify columns to treat as strings
        ]]></help>
        
        <citations>
            <citation type="bibtex">
    @misc{spac_toolkit,
        author = {FNLCR DMAP Team},
        title = {SPAC: SPAtial single-Cell analysis},
        year = {2024},
        url = {https://github.com/FNLCR-DMAP/SCSAWorkflow}
    }
            </citation>
        </citations>
    </tool>