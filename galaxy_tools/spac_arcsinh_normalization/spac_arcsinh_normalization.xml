<tool id="spac_arcsinh_normalization" name="Arcsinh Normalization [SPAC] [DMAP]" version="1.0.1" profile="21.05">
    <description>Normalize features either by a user-defined co-factor or a determined percentile.</description>
    
    <requirements>
        <container type="docker">nciccbr/spac:v1</container>
    </requirements>
    
    <environment_variables>
        <variable name="SPAC_PYTHON">python3</variable>
    </environment_variables>
    
    <command detect_errors="exit_code"><![CDATA[
        ## Make sure Galaxy will always have a log file to display
        : > tool_stdout.txt &&
        
        ## Run the universal wrapper
        bash $__tool_directory__/run_spac_template.sh "$params_json" arcsinh_normalization
    ]]></command>
    
    <configfiles>
        <inputs name="params_json" filename="params.json" data_style="paths"/>
    </configfiles>
    
    <inputs>
        <param name="Upstream_Analysis" type="data" format="h5ad,binary,pickle" label="Upstream Analysis" help="Link to prior processed dataset in the analysis."/>
        <param name="Table_to_Process" type="text" value="Original" label="Table to Process" help="Source table to perform the computation. Original refers to the raw dataset."/>
        <param name="Co_Factor" type="text" value="5.0" label="Co-Factor" help="A fixed positive number to use as a co-factor for the transformation."/>
        <param name="Percentile" type="text" value="None" label="Percentile" help="The percentile to determine the co-factor if the co-factor is not provided."/>
        <param name="Output_Table_Name" type="text" value="arcsinh" label="Output Table Name" help="Name of the table to be added to the analysis."/>
        <param name="Per_Batch" type="boolean" truevalue="True" falsevalue="False" checked="false" label="Per Batch" help="Whether to apply the transformation per batch."/>
        <param name="Annotation" type="text" value="None" label="Annotation" help="The name of the annotation to define batches. Required if Per Batch is True."/>
        
        <param name="outputs" type="hidden" value='{"analysis":"transform_output.pickle"}'/>
    </inputs>
    
    <outputs>
        <data name="analysis" format="binary" from_work_dir="transform_output.pickle" label="${tool.name} on ${on_string}: Analysis"/>
        <data name="config_used" format="json" from_work_dir="config_used.json" label="${tool.name} on ${on_string}: Parameters Used"/>
        <data name="execution_log" format="txt" from_work_dir="tool_stdout.txt" label="${tool.name} on ${on_string}: Execution Log"/>
    </outputs>
    
    <help><![CDATA[
        **Arcsinh Normalization [SPAC] [DMAP]**
        
        Normalize features either by a user-defined co-factor or a determined percentile.
    ]]></help>
</tool>