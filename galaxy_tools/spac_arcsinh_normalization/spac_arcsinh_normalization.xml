<tool id="spac_arcsinh_normalization" name="Arcsinh Normalization [SPAC] [DMAP]" version="1.0.0" profile="21.05">
        <description>Normalize features either by a user-defined co-factor or a determined percentile, allowing for ef...</description>
        
        <requirements>
            <container type="docker">nciccbr/spac:v1</container>
        </requirements>
        
        <environment_variables>
            <variable name="SPAC_PYTHON">python3</variable>
        </environment_variables>
        
        <command detect_errors="exit_code"><![CDATA[
            ## Ensure log file exists
            : > tool_stdout.txt &&
            
            ## Run the universal wrapper (template name without .py extension)
            bash $__tool_directory__/run_spac_template.sh "$params_json" arcsinh_normalization
        ]]></command>
        
        <configfiles>
            <!-- Galaxy serializes all inputs including hidden 'outputs' to this JSON -->
            <inputs name="params_json" filename="params.json" data_style="paths"/>
        </configfiles>
        
        <inputs>
            <param name="Upstream_Analysis" type="data" format="h5ad,binary" label="Upstream Analysis" help="Link to prior processed dataset in the analysis."/>
        <param name="Table_to_Process" type="text" value="Original" label="Table to Process" help="Source table to perform the computation. Original refers to the raw dataset."/>
        <param name="Co_Factor" type="text" value="5.0" label="Co-Factor" help="A fixed positive number to use as a co-factor for the transformation. If provided, it takes precedence over the percentile argument. If &quot;None&quot;, the Percentile method will be used. Default is &quot;5.0&quot;."/>
        <param name="Percentile" type="text" value="None" label="Percentile" help="The percentile to determine the co-factor if the co-factor is not provided. The percentile is computed for each feature (column) individually. Default is &quot;None&quot;."/>
        <param name="Output_Table_Name" type="text" value="arcsinh" label="Output Table Name" help="Name of the table to be added to the analysis."/>
        <param name="Per_Batch" type="boolean" truevalue="True" falsevalue="False" checked="false" label="Per Batch" help="Whether to apply the transformation per batch. If &quot;True&quot;, the transformation is applied per batch."/>
        <param name="Annotation" type="text" value="None" label="Annotation" help="The name of the annotation to define batches. Required if Per Batch is &quot;True&quot;."/>

        <!-- Hidden parameter to pass outputs specification to wrapper -->
        <param name="outputs" type="hidden" value='{"analysis": "transform_output.pickle"}'/>
        </inputs>
        
        <outputs>
            <data name="analysis" format="binary" from_work_dir="transform_output.pickle" 
                label="${tool.name} on ${on_string}: Analysis"/>
            <data name="config_used" format="json" from_work_dir="config_used.json" 
                label="${tool.name} on ${on_string}: Parameters Used"/>
            <data name="execution_log" format="txt" from_work_dir="tool_stdout.txt" 
                label="${tool.name} on ${on_string}: Execution Log"/>
        </outputs>
        
        <help><![CDATA[
            **Arcsinh Normalization [SPAC] [DMAP]**
            
            Normalize features either by a user-defined co-factor or a determined percentile, allowing for effective normalization of high-range values in single-cell datasets. This transformation can also be applied per batch if specified.
[GitHub Documentation](https://fnlcr-dmap.github.io/SCSAWorkflow/spac.html#spac.transformations.arcsinh_transformation) for further information.
            
            This tool is part of the SPAC (SPAtial single-Cell analysis) toolkit.
            
            **Input Format Notes:**
            - For list parameters: Use comma-separated values or one item per line
            - To select all items: Enter "All"
        ]]></help>
        
        <citations>
            <citation type="bibtex">
    @misc{spac_toolkit,
        author = {FNLCR DMAP Team},
        title = {SPAC: SPAtial single-Cell analysis},
        year = {2024},
        url = {https://github.com/FNLCR-DMAP/SCSAWorkflow}
    }
            </citation>
        </citations>
    </tool>