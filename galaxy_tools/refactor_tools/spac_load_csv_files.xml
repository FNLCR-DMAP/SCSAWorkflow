<tool id="spac_load_csv_files" name="Load CSV Files [SPAC] [DMAP]" version="1.0.0" profile="24.2">
    <description>Load CSV files from NIDAP dataset and combine them into a single pandas dataframe for downstream ...</description>
    
    <requirements>
        <container type="docker">nciccbr/spac:v1</container>
    </requirements>
    
    <environment_variables>
        <variable name="SPAC_PYTHON">python3</variable>
    </environment_variables>
    
        <command detect_errors="exit_code"><![CDATA[
            set -eu &&
            export GALAXY_OUTPUTS_SPEC='{"DataFrames": "combined_data.csv"}' &&
            
            ## Create directory for CSV_Files
            mkdir -p CSV_Files_dir &&
            
            ## Copy files to directory with original names
            #for $i, $file in enumerate($CSV_Files)
                cp '${file}' 'CSV_Files_dir/${file.name}' &&
            #end for
            
            ## Debug: Show params.json
            echo "=== params.json ===" >&2 &&
            cat "$params_json" >&2 &&
            echo "==================" >&2 &&
            
            ## Save snapshot
            cp "$params_json" params_snapshot.json &&
            
            ## Run wrapper
            bash $__tool_directory__/run_spac_template.sh "$params_json" "load_csv_files"
        ]]></command>
    
    <configfiles>
        <inputs name="params_json" filename="params.json" data_style="paths"/>
    </configfiles>
    
    <inputs>
        <param name="CSV_Files" type="data" format="csv,tabular,tsv,txt" multiple="true" label="CSV Files" help="The NIDAP dataset containing the CSV files of interest."/>
        <param name="CSV_Files_Configuration" type="data" format="csv,tabular,tsv,txt" label="CSV Files Configuration" help="The manual table specifying which CSV files to include in the analysis, and any specific labels to add to all cells within a CSV file. Please check the example in the documentation."/>
        <param name="String_Columns" type="text" area="true" value=""  label="String Columns" help="List specific columns to be read as string/text. (Enter as comma-separated list or one per line)"/>
    </inputs>
    
    <outputs>
        <data name="output_dataframe" format="csv" from_work_dir="combined_data.csv" label="${tool.name} on ${on_string}: Output Data"/>
        <data name="params_snapshot" format="json" from_work_dir="params_snapshot.json" label="${tool.name} on ${on_string}: Params Snapshot"/>
        <data name="config_used" format="json" from_work_dir="config_used.json" label="${tool.name} on ${on_string}: Config Used"/>
        <data name="execution_log" format="txt" from_work_dir="tool_stdout.txt" label="${tool.name} on ${on_string}: Execution Log"/>
    </outputs>
    
    <help><![CDATA[
        **Load CSV Files [SPAC] [DMAP]**

Load CSV files from NIDAP dataset and combine them into a single pandas dataframe for downstream processing. [GitHub Documentation](https://fnlcr-dmap.github.io/SCSAWorkflow/spac.html#spac.data_utils.combine_dfs) for further information.

This tool is part of the SPAC (SPAtial single-Cell analysis) toolkit.

**List Parameters:** Use comma-separated values or one per line.
**Special Values:** Enter "All" to select all items.
**Multiple File Inputs:** This tool accepts multiple files for: CSV_Files
    ]]></help>
    
    <citations>
        <citation type="bibtex">
@misc{spac_toolkit,
    author = {FNLCR DMAP Team},
    title = {SPAC: SPAtial single-Cell analysis},
    year = {2024},
    url = {https://github.com/FNLCR-DMAP/SCSAWorkflow}
}
        </citation>
    </citations>
</tool>