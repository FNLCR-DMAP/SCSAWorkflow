<?xml version="1.0" ?>
<tool id="spac_append_pin_color_rule" name="Append Pin Color Rule [DMAP] [SPAC]" version="2.0.0" profile="24.2">
    <description>Adds pin color rules to the analysis that can be used in downstream visualization. \
The consistent color representation of the same labels between different visualizations promotes the comprehensiven</description>
    <requirements>
        <container type="docker">nciccbr/spac:v2-dev</container>
    </requirements>
    <configfiles>
        <inputs name="params_json" filename="galaxy_params.json" data_style="paths"/>
    </configfiles>
    <command detect_errors="exit_code"><![CDATA[

echo '{"analysis": {"type": "file", "name": "output.pickle"}}' > outputs_config.json && python '$__tool_directory__/format_values.py' 'galaxy_params.json' 'cleaned_params.json' --bool-values Overwrite_Previous_Color_Map --list-values Label_Color_Map --inject-outputs --outputs-config outputs_config.json && python -c "from spac.templates.append_pin_color_rule_template import run_from_json; run_from_json('cleaned_params.json')"

]]></command>
    <inputs>
        <param name="Upstream_Analysis" type="data" format="h5ad,binary,pickle" label="Upstream Analysis" help="Link to prior processed dataset in the analysis"/>
        <repeat name="Label_Color_Map_repeat" title="Label Color Map">
            <param name="value" type="text" label="Value" help="List of string pairs representing the label and its assigned color. Each pair should have this format: &lt;label&gt;:&lt;color&gt; (without the '&lt;' '&gt;'). Example: b-cells:red. The values must be a single color string from the link provided in the description"/>
        </repeat>
        <param name="Color_Map_Name" type="text" label="Color Map Name" value="_spac_colors" help="Name of the color map to be stored in the analysis. Default is &quot;_spac_colors&quot;."/>
        <param name="Overwrite_Previous_Color_Map" type="boolean" label="Overwrite Previous Color Map" truevalue="True" falsevalue="False" checked="true" help="When True, if a color map with name defined in the &quot;Color Map Name&quot; option already exists in the analysis, the current color mapping rule run will replace existing ones."/>
    </inputs>
    <outputs>
        <data name="params_json_debug" format="json" from_work_dir="galaxy_params.json" label="${tool.name} on ${on_string}: Raw Parameters"/>
        <data name="cleaned_params_debug" format="json" from_work_dir="cleaned_params.json" label="${tool.name} on ${on_string}: Cleaned Parameters"/>
        <data name="analysis" format="binary" from_work_dir="output.pickle" label="${tool.name} on ${on_string}: Analysis"/>
    </outputs>
    <help><![CDATA[

**Append Pin Color Rule [DMAP] [SPAC]**
Adds pin color rules to the analysis that can be used in downstream visualization. \
The consistent color representation of the same labels between different visualizations promotes the comprehensiveness of the analysis.  \
The list of available color is defined in this link. \
Please refer to DUET Documentation and GitHub Documentation for further information.
**Outputs:**
- analysis: file (output.pickle)

]]></help>
    <citations>
        <citation type="bibtex">@misc{spac_toolkit,
    author = {FNLCR DMAP Team},
    title = {SPAC: SPAtial single-Cell analysis},
    year = {2022},
    url = {https://github.com/FNLCR-DMAP/SCSAWorkflow}
}</citation>
        <citation type="doi">10.1101/2025.04.02.646782</citation>
        <citation type="doi">10.48550/arXiv.2506.01560</citation>
    </citations>
</tool>