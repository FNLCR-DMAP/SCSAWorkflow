<?xml version="1.0" ?>
<tool id="spac_interactive_spatial_plot" name="Interactive Spatial Plot [SPAC] [DMAP]" version="2.0.0" profile="24.2">
    <description>Creates interactive, real-time visual explorations of single-cell spatial data for in-depth analysis. For color map strings, please refer to Built-in Continuous Color Scales in Python.\
Please refer t</description>
    <requirements>
        <container type="docker">spac:mvp</container>
    </requirements>
    <configfiles>
        <inputs name="params_json" filename="galaxy_params.json" data_style="paths"/>
    </configfiles>
    <command detect_errors="exit_code"><![CDATA[

echo '{"html": {"type": "directory", "name": "html_dir"}}' > outputs_config.json && python '$__tool_directory__/format_values.py' 'galaxy_params.json' 'cleaned_params.json' --bool-values Flip_Vertical_Axis --list-values Annotation_s_to_Highlight --inject-outputs --outputs-config outputs_config.json && python '$__tool_directory__/interactive_spatial_plot_template.py' 'cleaned_params.json'

]]></command>
    <inputs>
        <param name="Upstream_Analysis" type="data" format="h5ad,binary,pickle" label="Upstream Analysis" help="Link to prior processed dataset in the analysis."/>
        <param name="Stratify_By" type="text" label="Stratify By" value="None" help="The annotation to stratify the dataset when generating interaction plots. If single annotation is passed, the dataset will be stratified by the unique labels in the annotation column. Use &quot;None&quot; without quotes to disable."/>
        <section name="color_by" title="Color by" expanded="false">
            <param name="Color_By" type="select" label="Color By" help="Color the points in the plot by either their corresponding feature or annotation">
                <option value="Annotation" selected="true">Annotation</option>
                <option value="Feature">Feature</option>
            </param>
            <repeat name="Annotation_s_to_Highlight_repeat" title="Annotation(s) to Highlight">
                <param name="value" type="text" label="Value" help="Annotation(s) to visualize in the analysis. The interactive plot will show all the labels in the annotation(s) passed." value=""/>
            </repeat>
            <param name="Feature_to_Highlight" type="text" label="Feature to Highlight" value="None" help="Feature name in the analysis to use for coloring the cells in the scatter plot based on the feature value. Can't be used with Annotation."/>
            <param name="Table" type="text" label="Table" value="Original" help="Source table to perform the visualization. Default is Original, referring to the raw dataset."/>
        </section>
        <section name="figure_configuration" title="Figure Configuration" expanded="false">
            <param name="Font_Size" type="float" label="Font Size" value="12"/>
            <param name="Dot_Size" type="float" label="Dot Size" value="1.5" help="Size of dot in the plot."/>
            <param name="Dot_Transparency" type="float" label="Dot Transparency" value="0.75" help="Transparency of the dot in the plot."/>
            <param name="Flip_Vertical_Axis" type="boolean" label="Flip Vertical Axis" truevalue="True" falsevalue="False" checked="false" help="If True, flip the vertical axis."/>
            <param name="Figure_Width" type="float" label="Figure Width" value="6" help="Figure width in inch."/>
            <param name="Figure_Height" type="float" label="Figure Height" value="4" help="Figure height in inch."/>
            <param name="Define_Label_Color_Mapping" type="text" label="Define Label Color Mapping" value="None" help="Name of the color map to use for labels in the plot. The color map should be appended through the Append Pin Color Rule template prior to the current visualization. The default &quot;None&quot; will allow the visualization to determine the color of labels automatically."/>
            <param name="Figure_DPI" type="float" label="Figure DPI" value="200" help="The higher the DPI, the higher the image resolution."/>
            <param name="Feature_Color_Scale" type="select" label="Feature Color Scale" help="Color scale to use when dot colors are defined by features. Check the link in the template description.">
                <option value="balance" selected="true">balance</option>
                <option value="Picnic">Picnic</option>
            </param>
        </section>
        <section name="colorbar_range" title="Colorbar Range" expanded="false">
            <param name="Lower_Colorbar_Bound" type="float" label="Lower Colorbar Bound" value="999" help="The lower bound of the colorbar scale. The default 999 will set the upper bound to the minimum of the dataset."/>
            <param name="Upper_Colorbar_Bound" type="float" label="Upper Colorbar Bound" value="-999" help="The lower bound of the colorbar scale. The default -999 will set the upper bound to the minimum of the dataset."/>
        </section>
    </inputs>
    <outputs>
        <data name="params_json_debug" format="json" from_work_dir="galaxy_params.json" label="${tool.name} on ${on_string}: Raw Parameters"/>
        <data name="cleaned_params_debug" format="json" from_work_dir="cleaned_params.json" label="${tool.name} on ${on_string}: Cleaned Parameters"/>
        <collection name="html" type="list" label="${tool.name} on ${on_string}: Html">
            <discover_datasets pattern="__name_and_ext__" directory="html_dir"/>
        </collection>
    </outputs>
    <help><![CDATA[

**Interactive Spatial Plot [SPAC] [DMAP]**
Creates interactive, real-time visual explorations of single-cell spatial data for in-depth analysis. For color map strings, please refer to Built-in Continuous Color Scales in Python.\
Please refer to DUET Documentation and GitHub Documentation for further information.
**Outputs:**
- html: directory (html_dir)

]]></help>
    <citations>
        <citation type="doi">10.1038/s41586-019-1876-x</citation>
    </citations>
</tool>