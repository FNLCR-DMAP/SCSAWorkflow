<?xml version="1.0" ?>
<tool id="spac_setup_analysis" name="Setup Analysis [SPAC] [DMAP]" version="2.0.0" profile="24.2">
    <description>Convert the pre-processed dataset to the analysis object for downstream analysis.\
Please refer to DUET Documentation and GitHub Documentation for further information.</description>
    <requirements>
        <container type="docker">spac:mvp</container>
    </requirements>
    <configfiles>
        <inputs name="params_json" filename="galaxy_params.json" data_style="paths"/>
    </configfiles>
    <command detect_errors="exit_code"><![CDATA[

echo '{"analysis": {"type": "file", "name": "output.pickle"}}' > outputs_config.json && python '$__tool_directory__/format_values.py' 'galaxy_params.json' 'cleaned_params.json' --list-values Feature_Regex Annotation_s_ Features_to_Analyze --inject-outputs --outputs-config outputs_config.json && python '$__tool_directory__/setup_analysis_template.py' 'cleaned_params.json'

]]></command>
    <inputs>
        <param name="Upstream_Dataset" type="data" format="tabular,csv,tsv,txt" label="Upstream Dataset" help="Link to prior processed dataset in the analysis."/>
        <repeat name="Features_to_Analyze_repeat" title="Features to Analyze">
            <param name="value" type="text" label="Value" help="A list of feature name(s) for downstream analysis."/>
        </repeat>
        <param name="X_Coordinate_Column" type="text" label="X Coordinate Column" help="The name of the column containing the X coordinate, default if XMax."/>
        <param name="Y_Coordinate_Column" type="text" label="Y Coordinate Column" help="The name of the column containing the Y coordinate, default if YMax."/>
        <repeat name="Annotation_s__repeat" title="Annotation(s)">
            <param name="value" type="text" label="Value" help="The annotation(s) of interest to include in downstream analysis."/>
        </repeat>
        <section name="advanced_parameters" title="Advanced Parameters" expanded="false">
            <repeat name="Feature_Regex_repeat" title="Feature Regex">
                <param name="value" type="text" label="Value" help="A list of regex pattern(s) to search for features for downstream analysis. Regex example, if all features of interest ending with &quot;Intensity&quot;, use .*Intensity$, The .* means anything before the target pattern, and $ means the end of the string."/>
            </repeat>
        </section>
    </inputs>
    <outputs>
        <data name="params_json_debug" format="json" from_work_dir="galaxy_params.json" label="${tool.name} on ${on_string}: Raw Parameters"/>
        <data name="cleaned_params_debug" format="json" from_work_dir="cleaned_params.json" label="${tool.name} on ${on_string}: Cleaned Parameters"/>
        <data name="analysis" format="binary" from_work_dir="output.pickle" label="${tool.name} on ${on_string}: Analysis"/>
    </outputs>
    <help><![CDATA[

**Setup Analysis [SPAC] [DMAP]**
Convert the pre-processed dataset to the analysis object for downstream analysis.\
Please refer to DUET Documentation and GitHub Documentation for further information.
**Outputs:**
- analysis: file (output.pickle)

]]></help>
    <citations>
        <citation type="doi">10.1038/s41586-019-1876-x</citation>
    </citations>
</tool>