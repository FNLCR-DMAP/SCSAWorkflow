{
  "rid": "ri.vector.main.template.38089978-3603-4b9f-a3ca-3c9075a8da4f",
  "title": "Relational Heatmap [SPAC] [DMAP]",
  "description": "Relation Heatmap displays the relations between source and target annotation labels. A relationship is defined as a unique pair of values, one from the source annotation and one from the target annotation. Please refer to [DUET Documentation](https://nidap.nih.gov/workspace/notepad/view/ri.notepad.main.notepad.333ba88a-7980-432d-94fb-73e2e6f9f2af) and [GitHub Documentation](https://fnlcr-dmap.github.io/SCSAWorkflow/spac.html#spac.visualization.relational_heatmap) for further information.",
  "createdBy": "473c74f1-6764-4d6c-87e8-4a56c2b2f5a0",
  "createdAt": "2024-12-24T15:39:43.881484978Z",
  "commitMessage": "spac v0.8.0: Update for new function API",
  "status": "RELEASED",
  "inputDatasets": [
    {
      "key": "Upstream_Analysis",
      "displayName": "Upstream Analysis",
      "description": "Link to prior processed dataset in the analysis.",
      "paramGroup": null,
      "anchorDataset": null,
      "dataType": "PYTHON_TRANSFORM_INPUT",
      "tags": []
    }
  ],
  "parameters": [
    {
      "key": "Source_Annotation_Name",
      "displayName": "Source Annotation Name",
      "description": "Name of the source annotation. Display as vertical axis in the heatmap.",
      "paramType": "STRING",
      "paramGroup": null,
      "paramValues": null,
      "defaultValue": "None",
      "condition": null,
      "content": null,
      "objectPropertyReference": null
    },
    {
      "key": "Target_Annotation_Name",
      "displayName": "Target Annotation Name",
      "description": "Name of the source annotation. Display as horizontal axis in the heatmap.",
      "paramType": "STRING",
      "paramGroup": null,
      "paramValues": null,
      "defaultValue": "None",
      "condition": null,
      "content": null,
      "objectPropertyReference": null
    },
    {
      "key": "Colormap",
      "displayName": "Colormap",
      "description": "Colormap of annotation, default is \"darkmint\". Please refer to [Matplotlib Colormap](https://matplotlib.org/stable/users/explain/colors/colormaps.html) for further information",
      "paramType": "SELECT",
      "paramGroup": null,
      "paramValues": [
        "aggrnyl",
        "agsunset",
        "algae",
        "amp",
        "armyrose",
        "balance",
        "blackbody",
        "bluered",
        "blues",
        "blugrn",
        "bluyl",
        "brbg",
        "brwnyl",
        "bugn",
        "bupu",
        "burg",
        "burgyl",
        "cividis",
        "curl",
        "darkmint",
        "deep",
        "delta",
        "dense",
        "earth",
        "edge",
        "electric",
        "emrld",
        "fall",
        "geyser",
        "gnbu",
        "gray",
        "greens",
        "greys",
        "haline",
        "hot",
        "hsv",
        "ice",
        "icefire",
        "inferno",
        "jet",
        "magenta",
        "magma",
        "matter",
        "mint",
        "mrybm",
        "mygbm",
        "oranges",
        "orrd",
        "oryel",
        "oxy",
        "peach",
        "phase",
        "picnic",
        "pinkyl",
        "piyg",
        "plasma",
        "plotly3",
        "portland",
        "prgn",
        "pubu",
        "pubugn",
        "puor",
        "purd",
        "purp",
        "purples",
        "purpor",
        "rainbow",
        "rdbu",
        "rdgy",
        "rdpu",
        "rdylbu",
        "rdylgn",
        "redor",
        "reds",
        "solar",
        "spectral",
        "speed",
        "sunset",
        "sunsetdark",
        "teal",
        "tealgrn",
        "tealrose",
        "tempo",
        "temps",
        "thermal",
        "tropic",
        "turbid",
        "turbo",
        "twilight",
        "viridis",
        "ylgn",
        "ylgnbu",
        "ylorbr",
        "ylorrd"
      ],
      "defaultValue": "darkmint",
      "condition": null,
      "content": null,
      "objectPropertyReference": null
    },
    {
      "key": "Figure_Width_inch",
      "displayName": "Figure Width, inch",
      "description": "Figure Width, inch",
      "paramType": "NUMBER",
      "paramGroup": "Figure Configuration",
      "paramValues": null,
      "defaultValue": "8",
      "condition": null,
      "content": null,
      "objectPropertyReference": null
    },
    {
      "key": "Figure_Height_inch",
      "displayName": "Figure Height, inch",
      "description": "Figure Height, inch",
      "paramType": "NUMBER",
      "paramGroup": "Figure Configuration",
      "paramValues": null,
      "defaultValue": "10",
      "condition": null,
      "content": null,
      "objectPropertyReference": null
    },
    {
      "key": "Figure_DPI",
      "displayName": "Figure DPI",
      "description": "Dots Per squared Inch, higher the value, better the image quality",
      "paramType": "INTEGER",
      "paramGroup": "Figure Configuration",
      "paramValues": null,
      "defaultValue": "300",
      "condition": null,
      "content": null,
      "objectPropertyReference": null
    },
    {
      "key": "Font_Size",
      "displayName": "Font Size",
      "description": "Font Size",
      "paramType": "NUMBER",
      "paramGroup": "Figure Configuration",
      "paramValues": null,
      "defaultValue": "8",
      "condition": null,
      "content": null,
      "objectPropertyReference": null
    }
  ],
  "columns": [],
  "orderedMustacheKeys": [
    "Upstream_Analysis",
    "Source_Annotation_Name",
    "Target_Annotation_Name",
    "Colormap",
    "Figure_Width_inch",
    "Figure_Height_inch",
    "Figure_DPI",
    "Font_Size"
  ],
  "contents": {
    "type": "code",
    "code": {
      "codeLanguage": "PYTHON",
      "codeTemplate": "@synchronous_node_execution\ndef unnamed_5({{{Upstream_Analysis}}}):\n\n    ## --------- ##\n    ## Libraries ##\n    ## --------- ##\n\n    from spac.visualization import relational_heatmap\n    import pickle\n    import pandas as pd\n    import plotly.io as pio\n    import matplotlib.pyplot as plt    \n    from code_workbook_utils.utils import text_to_value\n\n    ## -------------------------------- ##\n    ## User-Defined Template Parameters ##\n    ## -------------------------------- ##\n    \n    NIDAP_dataset = {{{Upstream_Analysis}}}.filesystem()\n    with NIDAP_dataset.open(\"transform_output.pickle\", \"rb\") as input_file:\n        adata = pickle.load(input_file)\n\n    annotation_columns = ['{{{Source_Annotation_Name}}}', '{{{Target_Annotation_Name}}}']\n    dpi = {{{Figure_DPI}}}\n    width_in = {{{Figure_Width_inch}}}\n    height_in = {{{Figure_Height_inch}}}\n    width_px = width_in * 96\n    print(width_px)\n    height_px = height_in * 96\n    print(height_px)\n    \n    scale = dpi / 96\n\n    font_size = {{{Font_Size}}}\n    colormap = '{{{Colormap}}}'\n\n    ##--------------- ##\n    ## Error Messages ##\n    ## -------------- ##\n\n    ## --------- ##\n    ## Functions ##\n    ## --------- ##\n\n\n    ## --------------- ##\n    ## Main Code Block ##\n    ## --------------- ##\n    ################################\n\n    source_annotation = text_to_value(annotation_columns[0])\n\n    target_annotation = text_to_value(annotation_columns[1]) \n\n    result_dict = relational_heatmap(\n        adata=adata,\n        source_annotation=source_annotation,\n        target_annotation=target_annotation,\n        color_map=colormap,\n        font_size=font_size\n    )\n    \n    # extract results from function return\n    rhmap_file_name = result_dict['file_name']\n    rhmap_data = result_dict['data']\n    fig = result_dict['figure']\n\n    output = Transforms.get_output()\n    output_fs = output.filesystem()\n    tmp_image_name = f'sankey_diagram_{Transforms._transform_output.rid[-12:]}.png'\n    with output_fs.open(rhmap_file_name, 'w') as f:\n        rhmap_data.to_csv(f, index=True)\n\n    pio.write_image(\n        fig,\n        tmp_image_name,\n        width=width_px,  # Specify the width in pixels\n        height=height_px,\n        engine='kaleido',  # Use the 'kaleido' engine for high DPI images\n        scale=scale\n    )\n\n    img = plt.imread(tmp_image_name)\n    static, axs = plt.subplots(1, 1, figsize=(width_in, height_in), dpi=dpi) \n\n    # Load and display the image using Matplotlib\n    axs.imshow(img)\n    axs.axis('off')\n    plt.show()\n\n\n    fig.show()\n\n#################################################\n## Global imports and functions included below ##\n#################################################\n\n\n",
      "shouldPersist": true
    }
  },
  "version": 23,
  "externalId": null,
  "canEditTemplate": true,
  "path": "/NIDAP/NCI-Wide Analysis & Visualization Resources/SPAC/SPAC Templates/Relational Heatmap [SPAC] [DMAP]",
  "tags": [
    {
      "rid": "ri.compass.main.tag.02094a7d-d869-4dff-bc31-78ad8676d1ad",
      "name": "Code Templates:DMAP"
    },
    {
      "rid": "ri.compass.main.tag.ebb2ab0f-e354-4bd4-9f3a-e78dc8452986",
      "name": "Code Templates:SPAC"
    }
  ],
  "favorite": false,
  "namedCollections": [],
  "isDefault": true,
  "condaDependencies": [
    "python=3.6"
  ],
  "outputDatasetName": "relational_heatmap",
  "outputs": {
    "figures": {"type": "directory", "name": "figures_dir"},
    "html": {"type": "directory", "name": "html_dir"},
    "dataframe": {"type": "file", "name": "dataframe.csv"}
  }
}