{
  "rid": "ri.vector.main.template.3929c900-e97d-4cd6-beb8-e55d97995c19",
  "title": "Manual Phenotyping [SPAC] [DMAP]",
  "description": "Define and apply manual phenotypes to a dataset.  A new column with the annotation \"Manual Annotation Name\" will be added. \\\nPlease refer to [DUET Documentation](https://nidap.nih.gov/workspace/notepad/view/ri.notepad.main.notepad.fb92561c-fb99-4406-bc50-4188235833b0), [GitHub Documentation](https://fnlcr-dmap.github.io/SCSAWorkflow/spac.html#spac.phenotyping.assign_manual_phenotypes) for further information.",
  "createdBy": "2fdfc0bf-b680-4054-9cbc-2814fb01f8a4",
  "createdAt": "2025-01-06T17:50:57.791016596Z",
  "commitMessage": "Added github link",
  "status": "RELEASED",
  "inputDatasets": [
    {
      "key": "Upstream_Analysis",
      "displayName": "Upstream Analysis",
      "description": "Link to prior processed analysis in the analysis.",
      "paramGroup": null,
      "anchorDataset": null,
      "dataType": "PANDAS_DATAFRAME",
      "tags": []
    },
    {
      "key": "Phenotypes_Code",
      "displayName": "Phenotypes Code",
      "description": "The manual table with two columns: \"phenotype_code\" and \"phenotype_name\". The \"phenotype_code\" column is a logic expression specifying the features (markers) that should be positive '+' or negative '-' in a given phenotype. For example \"CD4+CD8-\".  Features not specified in the code can be positive or negative. \"phenotype_name\" should be any alphanumeric string that represent that phenotype.",
      "paramGroup": null,
      "anchorDataset": null,
      "dataType": "PANDAS_DATAFRAME",
      "tags": []
    }
  ],
  "parameters": [
    {
      "key": "Classification_Column_Prefix",
      "displayName": "Classification Column Prefix",
      "description": "The prefix to prepend to a feature (marker) name in \"phenotype_code\". Column names representing features in the phenotype name might have a common prefix and suffix. For example, the column name can be \"marker_CD4_classification\". In this case, the prefix is \"marker_\" and the suffix is \"_classification\", and the code should only mention CD4+ or CD4-.",
      "paramType": "STRING",
      "paramGroup": null,
      "paramValues": null,
      "defaultValue": "",
      "condition": null,
      "content": null,
      "objectPropertyReference": null
    },
    {
      "key": "Classification_Column_Suffix",
      "displayName": "Classification Column Suffix",
      "description": "The suffix to append to a feature (marker) name in \"phenotype_code\". Column names representing features in the phenotype name might have a common prefix and suffix. For example, the column name can be \"marker_CD4_classification\". In this case, the prefix is \"marker_\" and the suffix is \"_classification\", and the code should only mention CD4+ or CD4-.",
      "paramType": "STRING",
      "paramGroup": null,
      "paramValues": null,
      "defaultValue": "",
      "condition": null,
      "content": null,
      "objectPropertyReference": null
    },
    {
      "key": "Allow_Multiple_Phenotypes",
      "displayName": "Allow Multiple Phenotypes",
      "description": "Allow a given cell to match multiple phenotype_code. The resulting label will join all the \"phenotype_name\" using a ','. If set to False, the resulting cell will be marked as \"no_label\"",
      "paramType": "BOOLEAN",
      "paramGroup": null,
      "paramValues": null,
      "defaultValue": "True",
      "condition": null,
      "content": null,
      "objectPropertyReference": null
    },
    {
      "key": "Manual_Annotation_Name",
      "displayName": "Manual Annotation Name",
      "description": "The name of the new column (annotation) to be added to the dataset with the defined \"phenotype_name\"s as values. Cells that do not match any defined phenotype will be assiged \"no_label\".",
      "paramType": "STRING",
      "paramGroup": null,
      "paramValues": null,
      "defaultValue": "manual_phenotype",
      "condition": null,
      "content": null,
      "objectPropertyReference": null
    }
  ],
  "columns": [],
  "orderedMustacheKeys": [
    "Upstream_Dataset",
    "Phenotypes_Code",
    "Classification_Column_Prefix",
    "Classification_Column_Suffix",
    "Allow_Multiple_Phenotypes",
    "Manual_Annotation_Name"
  ],
  "contents": {
    "type": "code",
    "code": {
      "codeLanguage": "PYTHON",
      "codeTemplate": "def unnamed_14({{{Upstream_Dataset}}}, {{{Phenotypes_Code}}}):\n        ## --------- ##\n    ## Libraries ##\n    ## --------- ##\n    from spac.phenotyping import assign_manual_phenotypes\n    import pandas as pd\n\n    ## -------------------------------- ##\n    ## User-Defined Template Parameters ##\n    ## -------------------------------- ##\n\n    dataframe = {{{Upstream_Dataset}}}\n    phenotypes = {{{Phenotypes_Code}}}\n    prefix = \"{{{Classification_Column_Prefix}}}\"\n    suffix = \"{{{Classification_Column_Suffix}}}\"\n    multiple = {{{Allow_Multiple_Phenotypes}}}\n    manual_annotation = \"{{{Manual_Annotation_Name}}}\"\n\n    ##--------------- ##\n    ## Error Messages ##\n    ## -------------- ##\n\n\n    ## --------- ##\n    ## Functions ##\n    ## --------- ##\n\n    print(phenotypes)\n    \n\n\n\n    ## --------------- ##\n    ## Main Code Block ##\n    ## --------------- ##\n    ################################\n\n\n    returned_dic = assign_manual_phenotypes(\n        dataframe,\n        phenotypes,\n        prefix=prefix,\n        suffix=suffix,\n        annotation=manual_annotation,\n        multiple=multiple\n    )\n\n    # The dataframe changes in place\n    return(dataframe)\n    ",
      "shouldPersist": true
    }
  },
  "version": 5,
  "externalId": null,
  "canEditTemplate": true,
  "path": "/NIDAP/NCI-Wide Analysis & Visualization Resources/SPAC/SPAC Templates/Manual Phenotyping [SPAC] [DMAP]",
  "tags": [],
  "favorite": false,
  "namedCollections": [],
  "isDefault": true,
  "condaDependencies": [
    "python=3.6"
  ],
  "outputDatasetName": "manual_phenotype",
  "outputs": {
    "dataframe": {"type": "file", "name": "dataframe.csv"}
  }
}