{
  "rid": "ri.vector.main.template.1bb64f9d-4e82-4950-9940-2131fd88048a",
  "title": "Visualize Ripley L [SPAC][DMAP]",
  "description": "Plot the Ripley L function for two phenotypes, multiple radii, regions, and simulations.\\\nPlease refer to [DUET Documentation](https://nidap.nih.gov/workspace/notepad/view/ri.notepad.main.notepad.83456b12-2470-46cf-943b-e77b7808d466), [GitHub Documentation](https://fnlcr-dmap.github.io/SCSAWorkflow/spac.html#spac.visualization.plot_ripley_l) for further information.",
  "createdBy": "2fdfc0bf-b680-4054-9cbc-2814fb01f8a4",
  "createdAt": "2025-03-19T12:57:44.315582275Z",
  "commitMessage": "doc: Added the plot summary in the Logs tab",
  "status": "RELEASED",
  "inputDatasets": [
    {
      "key": "Upstream_Analysis",
      "displayName": "Upstream Analysis",
      "description": "Link to prior processed dataset in the analysis.",
      "paramGroup": null,
      "anchorDataset": null,
      "dataType": "PYTHON_TRANSFORM_INPUT",
      "tags": []
    }
  ],
  "parameters": [
    {
      "key": "Center_Phenotype",
      "displayName": "Center Phenotype",
      "description": "The phenotype of the anchor cells.",
      "paramType": "STRING",
      "paramGroup": null,
      "paramValues": null,
      "defaultValue": "",
      "condition": null,
      "content": null,
      "objectPropertyReference": null
    },
    {
      "key": "Neighbor_Phenotype",
      "displayName": "Neighbor Phenotype",
      "description": "The phenotype of the neighbors cells.",
      "paramType": "STRING",
      "paramGroup": null,
      "paramValues": null,
      "defaultValue": "",
      "condition": null,
      "content": null,
      "objectPropertyReference": null
    },
    {
      "key": "Plot_Specific_Regions",
      "displayName": "Plot Specific Regions",
      "description": "Set to True to plot Ripley L for specific regions of interest. If True, set the two parameters \"Regions Annotation\"  and \"Regions Labels(s)\"",
      "paramType": "BOOLEAN",
      "paramGroup": null,
      "paramValues": null,
      "defaultValue": "False",
      "condition": null,
      "content": null,
      "objectPropertyReference": null
    },
    {
      "key": "Regions_Label_s_",
      "displayName": "Regions Label(s)",
      "description": "The label(s) of the region(s) to plot.",
      "paramType": "LIST",
      "paramGroup": null,
      "paramValues": null,
      "defaultValue": null,
      "condition": null,
      "content": null,
      "objectPropertyReference": null
    },
    {
      "key": "Plot_Simulations",
      "displayName": "Plot Simulations",
      "description": "Plot the 95% confidence interval for the poisson point process simulations.",
      "paramType": "BOOLEAN",
      "paramGroup": null,
      "paramValues": null,
      "defaultValue": "True",
      "condition": null,
      "content": null,
      "objectPropertyReference": null
    }
  ],
  "columns": [],
  "orderedMustacheKeys": [
    "Upstream_Analysis",
    "Center_Phenotype",
    "Neighbor_Phenotype",
    "Plot_Specific_Regions",
    "Regions_Label_s_",
    "Plot_Simulations"
  ],
  "contents": {
    "type": "code",
    "code": {
      "codeLanguage": "PYTHON",
      "codeTemplate": "# Analysis to CSV [SPAC] [DMAP] (a767cbdf-7f21-4b08-b3a9-87ac0538457d): v6\n@synchronous_node_execution\ndef unnamed_23({{{Upstream_Analysis}}}):\n    ## --------- ##\n    ## Libraries ##\n    ## --------- ##\n    import pickle\n    import pandas as pd\n    from spac.utils import check_table\n    from spac.visualization import plot_ripley_l\n    from code_workbook_utils.utils import text_to_value\n    import matplotlib.pyplot as plt\n\n    ## -------------------------------- ##\n    ## User-Defined Template Parameters ##\n    ## -------------------------------- ##\n    NIDAP_dataset = {{{Upstream_Analysis}}}.filesystem()\n    with NIDAP_dataset.open(\"transform_output.pickle\", \"rb\") as input_file:\n        adata = pickle.load(input_file)\n\n    center_phenotype = \"{{{Center_Phenotype}}}\"\n    neighbor_phenotype = \"{{{Neighbor_Phenotype}}}\"\n    plot_specific_regions={{{Plot_Specific_Regions}}}\n    regions_labels = {{{Regions_Label_s_}}}\n    plot_simulations = {{{Plot_Simulations}}}\n\n    if plot_specific_regions:\n        if len(regions_labels) == 0:\n            raise ValueError('Please identify at least one region in the \"Regions Label(s) parameter')\n    else:\n        regions_labels=None\n\n\n    ## --------- ##\n    ## Functions ##\n    ## --------- ##\n\n\n    ## --------------- ##\n    ## Main Code Block ##\n    ## --------------- ##\n\n    \n    fig, plots_df = plot_ripley_l(\n        adata,\n        phenotypes=(center_phenotype, neighbor_phenotype),\n        regions=regions_labels,\n        sims=plot_simulations,\n        return_df=True\n    )\n\n    plt.show()\n\n    print(plots_df.to_string())\n\n    output_file = f\"plots.csv\"\n    output = Transforms.get_output()\n    output_fs = output.filesystem()\n\n    with output_fs.open(output_file, 'w') as f:\n        plots_df.to_csv(f, index=False)\n\n\n#################################################\n## Global imports and functions included below ##\n#################################################\n\n\n\n#################################################\n## Global imports and functions included below ##\n#################################################\n\n\n\n\n#################################################\n## Global imports and functions included below ##\n#################################################\n\n\n",
      "shouldPersist": true
    }
  },
  "version": 14,
  "externalId": null,
  "canEditTemplate": true,
  "path": "/NIDAP/NCI-Wide Analysis & Visualization Resources/SPAC/SPAC Templates/Visualize Ripley L [SPAC][DMAP]",
  "tags": [],
  "favorite": false,
  "namedCollections": [],
  "isDefault": true,
  "condaDependencies": [
    "python=3.6"
  ],
  "outputDatasetName": "New Dataset",
  "outputs": {
    "dataframe": {"type": "file", "name": "dataframe.csv"},
    "figures": {"type": "directory", "name": "figures_dir"}
  }
}