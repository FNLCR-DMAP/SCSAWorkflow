<?xml version="1.0" ?>
<tool id="spac_ripley_l_calculation" name="Ripley L Calculation [SPAC][DMAP]" version="2.0.0" profile="24.2">
    <description>Calculates the Ripley L statistic that measures the amount of clustering/dispersion between two cell phenotypes at different radii.  Compares that metric with a baseline where cells are assumed to fre</description>
    <requirements>
        <container type="docker">spac:mvp</container>
    </requirements>
    <configfiles>
        <inputs name="params_json" filename="galaxy_params.json" data_style="paths"/>
    </configfiles>
    <command detect_errors="exit_code"><![CDATA[

echo '{"analysis": {"type": "file", "name": "output.pickle"}}' > outputs_config.json && python '$__tool_directory__/format_values.py' 'galaxy_params.json' 'cleaned_params.json' --bool-values Edge_Correction --list-values Radii --inject-outputs --outputs-config outputs_config.json && python '$__tool_directory__/ripley_l_calculation_template.py' 'cleaned_params.json'

]]></command>
    <inputs>
        <param name="Upstream_Analysis" type="data" format="h5ad,binary,pickle" label="Upstream Analysis" help="Link to prior processed dataset in the analysis."/>
        <repeat name="Radii_repeat" title="Radii">
            <param name="value" type="text" label="Value" help="Radii around the center phenotype to calculate the Ripley L statistic"/>
        </repeat>
        <param name="Annotation" type="text" label="Annotation" value="" help="Annotation name to be used in specifying phenotypes"/>
        <param name="Center_Phenotype" type="text" label="Center Phenotype" value="" help="The phenotype of the anchors cells."/>
        <param name="Neighbor_Phenotype" type="text" label="Neighbor Phenotype" value="" help="The phenotype of the neighbors cells."/>
        <param name="Stratify_By" type="text" label="Stratify By" value="None" help="The annotation(s) to stratify the dataset when generating interaction plots. If a value other than &quot;None&quot; is passed, the dataset will be stratified by the unique labels in the annotation column. Use &quot;None&quot; without quotes to disable."/>
        <param name="Number_of_Simulations" type="integer" label="Number of Simulations" value="1" help="Number of simulation for the poisson point process where the Ripley L measure is estimated by shuffling the positions of the center and neighbor cells in the region of interest. The region of interest is defined as the convex hull that encapsulates all the cells in the region."/>
        <param name="Area" type="text" label="Area" value="None" help="Area to normalize the Ripley L statistic. If set to &quot;None&quot; without the quotes, the area of the convex hull that surrounds the cells would be used instead."/>
        <param name="Seed" type="integer" label="Seed" value="42" help="Random seed for reproducibility, used in simulating the poisson point process."/>
        <param name="Edge_Correction" type="boolean" label="Edge Correction" truevalue="True" falsevalue="False" checked="true" help="Set to True to identify and remove the cells that belong to the &quot;Center Phenotype&quot; that are closer than a given Radius from the edge of the region. These cells are identified for every Radius. Check the returned csv in the plot  to see how many cells contributed to the Ripley L calculation."/>
    </inputs>
    <outputs>
        <data name="params_json_debug" format="json" from_work_dir="galaxy_params.json" label="${tool.name} on ${on_string}: Raw Parameters"/>
        <data name="cleaned_params_debug" format="json" from_work_dir="cleaned_params.json" label="${tool.name} on ${on_string}: Cleaned Parameters"/>
        <data name="analysis" format="binary" from_work_dir="output.pickle" label="${tool.name} on ${on_string}: Analysis"/>
    </outputs>
    <help><![CDATA[

**Ripley L Calculation [SPAC][DMAP]**
Calculates the Ripley L statistic that measures the amount of clustering/dispersion between two cell phenotypes at different radii.  Compares that metric with a baseline where cells are assumed to freely move in a given region of interest.  \
Please refer to DUET Documentation, GitHub Documentation for further information.
**Outputs:**
- analysis: file (output.pickle)

]]></help>
    <citations>
        <citation type="doi">10.1038/s41586-019-1876-x</citation>
    </citations>
</tool>