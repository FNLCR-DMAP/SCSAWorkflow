<?xml version="1.0" ?>
<tool id="spac_sankey_plot" name="Sankey Plot [SPAC] [DMAP]" version="2.0.0" profile="24.2">
    <description>Generates a static and an interactive Sankey plot to visualize annotation relationships.  A relationship is defined as a unique pair of values, one from the source annotation and one from the target a</description>
    <requirements>
        <container type="docker">nciccbr/spac:v2-dev</container>
    </requirements>
    <configfiles>
        <inputs name="params_json" filename="galaxy_params.json" data_style="paths"/>
    </configfiles>
    <command detect_errors="exit_code"><![CDATA[

echo '{"figures": {"type": "directory", "name": "figures_dir"}, "html": {"type": "directory", "name": "html_dir"}}' > outputs_config.json && python '$__tool_directory__/format_values.py' 'galaxy_params.json' 'cleaned_params.json' --inject-outputs --outputs-config outputs_config.json && python -c "from spac.templates.sankey_plot_template import run_from_json; run_from_json('cleaned_params.json')"

]]></command>
    <inputs>
        <param name="Upstream_Analysis" type="data" format="h5ad,binary,pickle" label="Upstream Analysis" help="Link to prior processed dataset in the analysis."/>
        <param name="Source_Annotation_Name" type="text" label="Source Annotation Name" value="None" help="Name of the source annotation column. Display at the left of the Sankey plot."/>
        <param name="Target_Annotation_Name" type="text" label="Target Annotation Name" value="None" help="Name of the target annotation column. Display at the right of the Sankey plot."/>
        <param name="Source_Annotation_Color_Map" type="select" label="Source Annotation Color Map" help="Colormap of source annotation, default is tab20. Please refer to [Matplotlib Colormap](https://matplotlib.org/stable/users/explain/colors/colormaps.html) for further information">
            <option value="Pastel1">Pastel1</option>
            <option value="Pastel2">Pastel2</option>
            <option value="Paired">Paired</option>
            <option value="Accent">Accent</option>
            <option value="Dark2">Dark2</option>
            <option value="Set1">Set1</option>
            <option value="Set2">Set2</option>
            <option value="Set3">Set3</option>
            <option value="tab10">tab10</option>
            <option value="tab20" selected="true">tab20</option>
            <option value="tab20b">tab20b</option>
            <option value="tab20c">tab20c</option>
            <option value="binary">binary</option>
            <option value="gist_yarg">gist_yarg</option>
            <option value="gist_gray">gist_gray</option>
            <option value="gray">gray</option>
            <option value="bone">bone</option>
            <option value="viridis">viridis</option>
            <option value="plasma">plasma</option>
            <option value="inferno">inferno</option>
            <option value="magma">magma</option>
            <option value="cividis">cividis</option>
            <option value="pink">pink</option>
            <option value="spring">spring</option>
            <option value="summer">summer</option>
            <option value="autumn">autumn</option>
            <option value="winter">winter</option>
            <option value="cool">cool</option>
            <option value="Wistia">Wistia</option>
            <option value="hot">hot</option>
            <option value="afmhot">afmhot</option>
            <option value="gist_heat">gist_heat</option>
            <option value="copper">copper</option>
            <option value="Greys">Greys</option>
            <option value="Purples">Purples</option>
            <option value="Blues">Blues</option>
            <option value="Greens">Greens</option>
            <option value="Oranges">Oranges</option>
            <option value="Reds">Reds</option>
            <option value="YlOrBr">YlOrBr</option>
            <option value="YlOrRd">YlOrRd</option>
            <option value="OrRd">OrRd</option>
            <option value="PuRd">PuRd</option>
            <option value="RdPu">RdPu</option>
            <option value="BuPu">BuPu</option>
            <option value="GnBu">GnBu</option>
            <option value="PuBu">PuBu</option>
            <option value="YlGnBu">YlGnBu</option>
            <option value="PuBuGn">PuBuGn</option>
            <option value="BuGn">BuGn</option>
            <option value="YlGn">YlGn</option>
        </param>
        <param name="Target_Annotation_Color_Map" type="select" label="Target Annotation Color Map" help="Colormap of target annotation, default is tab20b. Please refer to [Matplotlib Colormap](https://matplotlib.org/stable/users/explain/colors/colormaps.html) for further information">
            <option value="Pastel1">Pastel1</option>
            <option value="Pastel2">Pastel2</option>
            <option value="Paired">Paired</option>
            <option value="Accent">Accent</option>
            <option value="Dark2">Dark2</option>
            <option value="Set1">Set1</option>
            <option value="Set2">Set2</option>
            <option value="Set3">Set3</option>
            <option value="tab10">tab10</option>
            <option value="tab20">tab20</option>
            <option value="tab20b" selected="true">tab20b</option>
            <option value="tab20c">tab20c</option>
            <option value="binary">binary</option>
            <option value="gist_yarg">gist_yarg</option>
            <option value="gist_gray">gist_gray</option>
            <option value="gray">gray</option>
            <option value="bone">bone</option>
            <option value="viridis">viridis</option>
            <option value="plasma">plasma</option>
            <option value="inferno">inferno</option>
            <option value="magma">magma</option>
            <option value="cividis">cividis</option>
            <option value="pink">pink</option>
            <option value="spring">spring</option>
            <option value="summer">summer</option>
            <option value="autumn">autumn</option>
            <option value="winter">winter</option>
            <option value="cool">cool</option>
            <option value="Wistia">Wistia</option>
            <option value="hot">hot</option>
            <option value="afmhot">afmhot</option>
            <option value="gist_heat">gist_heat</option>
            <option value="copper">copper</option>
            <option value="Greys">Greys</option>
            <option value="Purples">Purples</option>
            <option value="Blues">Blues</option>
            <option value="Greens">Greens</option>
            <option value="Oranges">Oranges</option>
            <option value="Reds">Reds</option>
            <option value="YlOrBr">YlOrBr</option>
            <option value="YlOrRd">YlOrRd</option>
            <option value="OrRd">OrRd</option>
            <option value="PuRd">PuRd</option>
            <option value="RdPu">RdPu</option>
            <option value="BuPu">BuPu</option>
            <option value="GnBu">GnBu</option>
            <option value="PuBu">PuBu</option>
            <option value="YlGnBu">YlGnBu</option>
            <option value="PuBuGn">PuBuGn</option>
            <option value="BuGn">BuGn</option>
            <option value="YlGn">YlGn</option>
        </param>
        <section name="figure_configuration_parameters" title="Figure Configuration parameters" expanded="false">
            <param name="Figure_Width_inch" type="float" label="Figure Width, inch" value="6" help="Figure Width, inch"/>
            <param name="Figure_Height_inch" type="float" label="Figure Height, inch" value="6" help="Figure Height, inch"/>
            <param name="Figure_DPI" type="float" label="Figure DPI" value="300" help="Dots Per squared Inch, higher the value, better the image quality"/>
            <param name="Font_Size" type="float" label="Font Size" value="12" help="Font Size"/>
        </section>
    </inputs>
    <outputs>
        <data name="params_json_debug" format="json" from_work_dir="galaxy_params.json" label="${tool.name} on ${on_string}: Raw Parameters"/>
        <data name="cleaned_params_debug" format="json" from_work_dir="cleaned_params.json" label="${tool.name} on ${on_string}: Cleaned Parameters"/>
        <collection name="figures" type="list" label="${tool.name} on ${on_string}: Figures">
            <discover_datasets pattern="__name_and_ext__" directory="figures_dir"/>
        </collection>
        <collection name="html" type="list" label="${tool.name} on ${on_string}: Html">
            <discover_datasets pattern="__name_and_ext__" directory="html_dir"/>
        </collection>
    </outputs>
    <help><![CDATA[

**Sankey Plot [SPAC] [DMAP]**
Generates a static and an interactive Sankey plot to visualize annotation relationships.  A relationship is defined as a unique pair of values, one from the source annotation and one from the target annotation.\
Please refer to DUET Documentation and GitHub Documentation for further information.
**Outputs:**
- figures: directory (figures_dir)
- html: directory (html_dir)

]]></help>
    <citations>
        <citation type="bibtex">@misc{spac_toolkit,
    author = {FNLCR DMAP Team},
    title = {SPAC: SPAtial single-Cell analysis},
    year = {2022},
    url = {https://github.com/FNLCR-DMAP/SCSAWorkflow}
}</citation>
        <citation type="doi">10.1101/2025.04.02.646782</citation>
        <citation type="doi">10.48550/arXiv.2506.01560</citation>
    </citations>
</tool>