<?xml version="1.0" ?>
<tool id="spac_load_csv_files" name="Load CSV Files [SPAC] [DMAP]" version="2.0.0" profile="24.2">
    <description>Load CSV files from NIDAP dataset and combine them into a single pandas dataframe for downstream processing. Please refer to DUET Documentation and GitHub Documentation for further information.</description>
    <requirements>
        <container type="docker">nciccbr/spac:v2-dev</container>
    </requirements>
    <configfiles>
        <inputs name="params_json" filename="galaxy_params.json" data_style="paths"/>
    </configfiles>
    <command detect_errors="exit_code"><![CDATA[

mkdir -p csv_files_staged &&
#for $f in $CSV_Files#
cp '$f' 'csv_files_staged/${f.name}' &&
#end for#
echo '{"dataframe": {"type": "file", "name": "dataframe.csv"}}' > outputs_config.json &&
python '$__tool_directory__/format_values.py' 'galaxy_params.json' 'cleaned_params.json' --list-values String_Columns --set-param CSV_Files=csv_files_staged --inject-outputs --outputs-config outputs_config.json &&
python -c "from spac.templates.load_csv_files_template import run_from_json; run_from_json('cleaned_params.json')"

]]></command>
    <inputs>
        <param name="CSV_Files" type="data" format="tabular,csv,tsv,txt" multiple="true" label="CSV Files" help="The NIDAP dataset containing the CSV files of interest."/>
        <param name="CSV_Files_Configuration" type="data" format="tabular,csv,tsv,txt" label="CSV Files Configuration" help="The manual table specifying which CSV files to include in the analysis, and any specific labels to add to all cells within a CSV file. Please check the example in the documentation."/>
        <repeat name="String_Columns_repeat" title="String Columns">
            <param name="value" type="text" label="Value" help="List specific columns to be read as string/text."/>
        </repeat>
    </inputs>
    <outputs>
        <data name="params_json_debug" format="json" from_work_dir="galaxy_params.json" label="${tool.name} on ${on_string}: Raw Parameters"/>
        <data name="cleaned_params_debug" format="json" from_work_dir="cleaned_params.json" label="${tool.name} on ${on_string}: Cleaned Parameters"/>
        <data name="dataframe" format="csv" from_work_dir="dataframe.csv" label="${tool.name} on ${on_string}: Dataframe"/>
    </outputs>
    <help><![CDATA[

**Load CSV Files [SPAC] [DMAP]**
Load CSV files from NIDAP dataset and combine them into a single pandas dataframe for downstream processing. Please refer to DUET Documentation and GitHub Documentation for further information.
**Outputs:**
- dataframe: file (dataframe.csv)

]]></help>
    <citations>
        <citation type="bibtex">@misc{spac_toolkit,
    author = {FNLCR DMAP Team},
    title = {SPAC: SPAtial single-Cell analysis},
    year = {2022},
    url = {https://github.com/FNLCR-DMAP/SCSAWorkflow}
}</citation>
        <citation type="doi">10.1101/2025.04.02.646782</citation>
        <citation type="doi">10.48550/arXiv.2506.01560</citation>
    </citations>
</tool>