<tool id="spac_zscore_normalization" name="Z-Score Normalization [DMAP] [SPAC]" version="1.0.0" profile="21.05">
        <description>Perform z-scores normalization for the selected data table in the analysis. Normalized data table...</description>
        
        <requirements>
            <container type="docker">nciccbr/spac:v1</container>
        </requirements>
        
        <environment_variables>
            <variable name="SPAC_PYTHON">python3</variable>
        </environment_variables>
        
        <command detect_errors="exit_code"><![CDATA[
            ## Ensure log file exists
            : > tool_stdout.txt &&
            
            ## Run the universal wrapper (template name without .py extension)
            bash $__tool_directory__/run_spac_template.sh "$params_json" zscore_normalization
        ]]></command>
        
        <configfiles>
            <!-- Galaxy serializes all inputs including hidden 'outputs' to this JSON -->
            <inputs name="params_json" filename="params.json" data_style="paths"/>
        </configfiles>
        
        <inputs>
            <param name="Upstream_Analysis" type="data" format="h5ad,binary,pickle" label="Upstream Analysis" help="Link to prior processed dataset in the analysis."/>
        <param name="Table_to_Process" type="text" value="Original" label="Table to Process" help="Source table to perform the computation. Original refers to the raw dataset."/>
        <param name="Output_Table_Name" type="text" value="z_scores" label="Output Table Name" help="Name of the table to be added to the analysis. Default is &quot;z_scores&quot;."/>

        <!-- Hidden parameter to pass outputs specification to wrapper -->
        <param name="outputs" type="hidden" value='{"analysis": "transform_output.pickle"}'/>
        </inputs>
        
        <outputs>
            <data name="analysis" format="pickle" from_work_dir="transform_output.pickle" label="${tool.name} on ${on_string}: Analysis"/>
        <data name="config_used" format="json" from_work_dir="config_used.json" label="${tool.name} on ${on_string}: Parameters Used"/>
        <data name="execution_log" format="txt" from_work_dir="tool_stdout.txt" label="${tool.name} on ${on_string}: Execution Log"/>
        </outputs>
        
        <help><![CDATA[
            **Z-Score Normalization [DMAP] [SPAC]**
            
            Perform z-scores normalization for the selected data table in the analysis. Normalized data table is stored under name "z_scores".
[GitHub Documentation](https://fnlcr-dmap.github.io/SCSAWorkflow/spac.html#spac.transformations.z_score_normalization) for further information.
            
            This tool is part of the SPAC (SPAtial single-Cell analysis) toolkit.
            
            **Input Format Notes:**
            - For list parameters: Use comma-separated values or one item per line
            - To select all items: Enter "All"
        ]]></help>
        
        <citations>
            <citation type="bibtex">
    @misc{spac_toolkit,
        author = {FNLCR DMAP Team},
        title = {SPAC: SPAtial single-Cell analysis},
        year = {2024},
        url = {https://github.com/FNLCR-DMAP/SCSAWorkflow}
    }
            </citation>
        </citations>
    </tool>