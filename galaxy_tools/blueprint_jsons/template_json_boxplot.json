{
  "rid": "ri.vector.main.template.266414a4-406e-4c90-938b-893932beca90",
  "title": "Boxplot [SPAC] [DMAP]",
  "description": "Create a boxplot visualization of the features in the analysis dataset.\\\nPlease refer to [DUET Documentation](https://nidap.nih.gov/shares/links/bvvbqjww7rqic),  [GitHub Documentation](https://fnlcr-dmap.github.io/SCSAWorkflow/spac.html#spac.visualization.boxplot)",
  "createdBy": "2fdfc0bf-b680-4054-9cbc-2814fb01f8a4",
  "createdAt": "2024-11-07T16:32:43.832661427Z",
  "commitMessage": "",
  "status": "RELEASED",
  "inputDatasets": [
    {
      "key": "Upstream_Analysis",
      "displayName": "Upstream Analysis",
      "description": "Link to prior processed dataset in the analysis.",
      "paramGroup": null,
      "anchorDataset": null,
      "dataType": "PYTHON_TRANSFORM_INPUT",
      "tags": []
    }
  ],
  "parameters": [
    {
      "key": "Table_to_Visualize",
      "displayName": "Table to Visualize",
      "description": "Source table to perform the visualization. Default is Original, referring to the raw dataset.",
      "paramType": "STRING",
      "paramGroup": null,
      "paramValues": null,
      "defaultValue": "Original",
      "condition": null,
      "content": null,
      "objectPropertyReference": null
    },
    {
      "key": "Feature_s_to_Plot",
      "displayName": "Feature(s) to Plot",
      "description": "The feature(s) to plot in the box plot. Default \"All\" will plot all features.",
      "paramType": "LIST",
      "paramGroup": null,
      "paramValues": null,
      "defaultValue": "All",
      "condition": null,
      "content": null,
      "objectPropertyReference": null
    },
    {
      "key": "Primary_Annotation",
      "displayName": "Primary Annotation",
      "description": "The annotation to group the visualizations. Use \"None\" to disable.",
      "paramType": "STRING",
      "paramGroup": null,
      "paramValues": null,
      "defaultValue": "None",
      "condition": null,
      "content": null,
      "objectPropertyReference": null
    },
    {
      "key": "Secondary_Annotation",
      "displayName": "Secondary Annotation",
      "description": "Secondary annotation to create subdivisions within each category defined by the primary annotation, offering a deeper level of analysis, such as comparing time points within each treatment condition. Default is \"None\".",
      "paramType": "STRING",
      "paramGroup": null,
      "paramValues": null,
      "defaultValue": "None",
      "condition": null,
      "content": null,
      "objectPropertyReference": null
    },
    {
      "key": "Value_Axis_Log_Scale",
      "displayName": "Value Axis Log Scale",
      "description": "Make the Y-axis (or X-axis if the plot is horizontal) in log scale. Negative values in the data disable the log scale.",
      "paramType": "BOOLEAN",
      "paramGroup": "Value Axis Configuration parameters",
      "paramValues": null,
      "defaultValue": "False",
      "condition": null,
      "content": null,
      "objectPropertyReference": null
    },
    {
      "key": "Figure_Title",
      "displayName": "Figure Title",
      "description": "Title of the figure",
      "paramType": "STRING",
      "paramGroup": "Figure Configuration parameters",
      "paramValues": null,
      "defaultValue": "BoxPlot",
      "condition": null,
      "content": null,
      "objectPropertyReference": null
    },
    {
      "key": "Horizontal_Plot",
      "displayName": "Horizontal Plot",
      "description": "To plot the boxplot in horizontal orientation. Default is vertical.",
      "paramType": "BOOLEAN",
      "paramGroup": "Figure Configuration parameters",
      "paramValues": null,
      "defaultValue": "False",
      "condition": null,
      "content": null,
      "objectPropertyReference": null
    },
    {
      "key": "Figure_Width",
      "displayName": "Figure Width",
      "description": "Width of the figure, inch.",
      "paramType": "NUMBER",
      "paramGroup": "Figure Configuration parameters",
      "paramValues": null,
      "defaultValue": "12",
      "condition": null,
      "content": null,
      "objectPropertyReference": null
    },
    {
      "key": "Figure_Height",
      "displayName": "Figure Height",
      "description": "Height of the figure, inch.",
      "paramType": "NUMBER",
      "paramGroup": "Figure Configuration parameters",
      "paramValues": null,
      "defaultValue": "8",
      "condition": null,
      "content": null,
      "objectPropertyReference": null
    },
    {
      "key": "Figure_DPI",
      "displayName": "Figure DPI",
      "description": "Higher the DPI, clearer the image.",
      "paramType": "NUMBER",
      "paramGroup": "Figure Configuration parameters",
      "paramValues": null,
      "defaultValue": "300",
      "condition": null,
      "content": null,
      "objectPropertyReference": null
    },
    {
      "key": "Font_Size",
      "displayName": "Font Size",
      "description": "Figure font size.",
      "paramType": "NUMBER",
      "paramGroup": "Figure Configuration parameters",
      "paramValues": null,
      "defaultValue": "10",
      "condition": null,
      "content": null,
      "objectPropertyReference": null
    },
    {
      "key": "Keep_Outliers",
      "displayName": "Keep Outliers",
      "description": "True to keep the outliers for every feature, False to remove them",
      "paramType": "BOOLEAN",
      "paramGroup": "Value Axis Configuration parameters",
      "paramValues": null,
      "defaultValue": "True",
      "condition": null,
      "content": null,
      "objectPropertyReference": null
    }
  ],
  "columns": [],
  "orderedMustacheKeys": [
    "Upstream_Analysis",
    "Table_to_Visualize",
    "Feature_s_to_Plot",
    "Primary_Annotation",
    "Secondary_Annotation",
    "Value_Axis_Log_Scale",
    "Figure_Title",
    "Horizontal_Plot",
    "Figure_Width",
    "Figure_Height",
    "Figure_DPI",
    "Font_Size",
    "Keep_Outliers"
  ],
  "contents": {
    "type": "code",
    "code": {
      "codeLanguage": "PYTHON",
      "codeTemplate": "@synchronous_node_execution\ndef default_boxplot({{{Upstream_Analysis}}}):\n    ## --------- ##\n    ## Libraries ##\n    ## --------- ##\n\n    import pickle\n    import pandas as pd\n    import seaborn as sns\n    import matplotlib.pyplot as plt\n    from spac.visualization import boxplot\n\n    ## -------------------------------- ##\n    ## User-Defined Template Parameters ##\n    ## -------------------------------- ##\n\n    NIDAP_dataset = {{{Upstream_Analysis}}}.filesystem()\n    with NIDAP_dataset.open(\"transform_output.pickle\", \"rb\") as input_file:\n        adata = pickle.load(input_file)\n    \n    annotation = \"{{{Primary_Annotation}}}\"\n    second_annotation = \"{{{Secondary_Annotation}}}\"\n    layer_to_plot = \"{{{Table_to_Visualize}}}\"\n    feature_to_plot = {{{Feature_s_to_Plot}}}\n    log_scale = {{{Value_Axis_Log_Scale}}}\n    y_min = 9999\n    y_max = 9999\n\n    Figure_Title = \"{{{Figure_Title}}}\"\n    Figure_Horizontal={{{Horizontal_Plot}}}\n\n    fig_width = {{{Figure_Width}}}\n    fig_height = {{{Figure_Height}}}\n    fig_dpi = {{{Figure_DPI}}}\n    font_size = {{{Font_Size}}}\n    showfliers = {{{Keep_Outliers}}}\n\n    if layer_to_plot == \"Original\":\n        layer_to_plot = None\n    \n    if second_annotation == \"None\":\n        second_annotation = None\n    \n    if annotation == \"None\":\n        annotation = None\n\n    if Figure_Horizontal:\n        Figure_Orientation=\"h\"\n    else:\n        Figure_Orientation=\"v\"\n\n    if any(item == \"All\" for item in feature_to_plot):\n        print(\"Plotting All Features\")\n        feature_to_plot=adata.var_names.tolist()\n    else:\n        feature_str=\"\\n\".join(feature_to_plot)\n        print(f\"Plotting Feature:\\n{feature_str}\")\n\n\n    ##--------------- ##\n    ## Error Messages ##\n    ## -------------- ##\n\n    ## --------- ##\n    ## Functions ##\n    ## --------- ##\n\n    ## --------------- ##\n    ## Main Code Block ##\n    ## --------------- ##\n\n    fig, ax = plt.subplots()\n    plt.rcParams.update({'font.size': font_size})\n    fig.set_size_inches(fig_width, fig_height)\n    fig.set_dpi(fig_dpi)\n\n    fig, ax, df = boxplot(\n        adata=adata,\n        ax=ax,\n        layer=layer_to_plot,\n        annotation=annotation,\n        second_annotation=second_annotation,\n        features=feature_to_plot,\n        log_scale=log_scale,\n        orient=Figure_Orientation,\n        showfliers=showfliers\n        )\n    # Get summary statistics of the log-transformed or linear dataset\n    print(\"Summary statistics of the dataset:\")\n    summary = df.describe()\n\n    # Convert the summary to a DataFrame that includes the index as a column\n    summary_df = summary.reset_index()\n    print(summary_df)\n    \n    # Move the legend outside the plotting area\n\n    # Check if a legend exists\n    try:\n        sns.move_legend(ax, \"upper left\", bbox_to_anchor=(1, 1))\n    except Exception as e:\n        print(f\"Legend does not exist.\")\n    \n    # plt.close('all')\n    plt.tight_layout()\n    plt.show()\n\n\n    return summary_df",
      "shouldPersist": true
    }
  },
  "version": 36,
  "externalId": null,
  "canEditTemplate": true,
  "path": "/NIDAP/NCI-Wide Analysis & Visualization Resources/SPAC/SPAC Templates/Boxplot [SPAC] [DMAP]",
  "tags": [
    {
      "rid": "ri.compass.main.tag.02094a7d-d869-4dff-bc31-78ad8676d1ad",
      "name": "Code Templates:DMAP"
    },
    {
      "rid": "ri.compass.main.tag.ebb2ab0f-e354-4bd4-9f3a-e78dc8452986",
      "name": "Code Templates:SPAC"
    }
  ],
  "favorite": false,
  "namedCollections": [],
  "isDefault": true,
  "condaDependencies": [
    "python=3.6"
  ],
  "outputDatasetName": "New Dataset",
  "outputs": {
    "dataframe": {
      "type": "file",
      "name": "dataframe.csv"
    },
    "figures": {
        "type": "directory",
        "name": "figures_dir"
    }
  }
}