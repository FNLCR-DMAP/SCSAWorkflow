{
  "rid": "ri.vector.main.template.bfc2dffa-c727-4ab7-902e-8d473a55009e",
  "title": "Summarize Annotation Statistics [SPAC] [DMAP]",
  "description": "Calculates aggregate statistics for each cluster or label from specific annotation against selected features. To view the results, please click on 'Preview.'\\\nPlease refer to [DUET Documentation](https://nidap.nih.gov/shares/links/3usrm5edqhuqo), and [GitHub Documentation](https://fnlcr-dmap.github.io/SCSAWorkflow/spac.html#spac.transformations.get_cluster_info) for further information.",
  "createdBy": "391048e4-979e-4237-a0f4-9f34b125a427",
  "createdAt": "2024-09-06T01:27:23.451581373Z",
  "commitMessage": "spac v0.7.0",
  "status": "RELEASED",
  "inputDatasets": [
    {
      "key": "Upstream_Analysis",
      "displayName": "Upstream Analysis",
      "description": "Link to prior processed dataset in the analysis.",
      "paramGroup": null,
      "anchorDataset": null,
      "dataType": "PYTHON_TRANSFORM_INPUT",
      "tags": []
    }
  ],
  "parameters": [
    {
      "key": "Table_to_Process",
      "displayName": "Table to Process",
      "description": "Source table to perform the computation. Original refers to the raw dataset.",
      "paramType": "STRING",
      "paramGroup": null,
      "paramValues": null,
      "defaultValue": "Original",
      "condition": null,
      "content": null,
      "objectPropertyReference": null
    },
    {
      "key": "Annotation",
      "displayName": "Annotation",
      "description": "The annotation to extract label info.",
      "paramType": "STRING",
      "paramGroup": null,
      "paramValues": null,
      "defaultValue": "None",
      "condition": null,
      "content": null,
      "objectPropertyReference": null
    },
    {
      "key": "Feature_s_",
      "displayName": "Feature(s)",
      "description": "Specifies features (e.g., biomarkers) for annotation metrics. Add multiple features by selecting \"Add item\" for each. The default 'All' includes all dataset features.",
      "paramType": "LIST",
      "paramGroup": null,
      "paramValues": null,
      "defaultValue": "All",
      "condition": null,
      "content": null,
      "objectPropertyReference": null
    }
  ],
  "columns": [],
  "orderedMustacheKeys": [
    "Upstream_Analysis",
    "Table_to_Process",
    "Annotation",
    "Feature_s_"
  ],
  "contents": {
    "type": "code",
    "code": {
      "codeLanguage": "PYTHON",
      "codeTemplate": "def summarize_annotation_statistics({{{Upstream_Analysis}}}):\n\n    ## --------- ##\n    ## Libraries ##\n    ## --------- ##\n\n    import pickle\n    import pandas as pd\n    from spac.transformations import get_cluster_info\n\n    ## -------------------------------- ##\n    ## User-Defined Template Parameters ##\n    ## -------------------------------- ## \n\n    NIDAP_dataset = {{{Upstream_Analysis}}}.filesystem()\n    with NIDAP_dataset.open(\"transform_output.pickle\", \"rb\") as input_file:\n        adata = pickle.load(input_file)\n\n    layer = \"{{{Table_to_Process}}}\"\n    features = {{{Feature_s_}}}\n    annotation = \"{{{Annotation}}}\"\n\n    ##--------------- ##\n    ## Error Messages ##\n    ## -------------- ##\n\n    ## --------- ##\n    ## Functions ##\n    ## --------- ##\n\n    if layer == \"Original\":\n        layer = None\n        \n    if len(features) == 1 and features[0] == \"All\":\n        features = None\n\n    if annotation == \"None\":\n        annotation = None\n\n    ## --------------- ##\n    ## Main Code Block ##\n    ## --------------- ##\n\n    info = get_cluster_info(\n        adata=adata,\n        layer=layer,\n        annotation=annotation,\n        features=features\n    )\n\n    df = pd.DataFrame(info)\n\n    # Renaming columns to avoid spaces and special characters\n    # Assuming `info` is a pandas DataFrame\n    df.columns = [col.replace(\" \", \"_\").replace(\"-\", \"_\") for col in df.columns]\n\n    # Get summary statistics of returned dataset\n    print(\"Summary statistics of the dataset:\", df.describe())\n\n    return df\n\n#################################################\n## Global imports and functions included below ##\n#################################################\n\n\n",
      "shouldPersist": true
    }
  },
  "version": 28,
  "externalId": null,
  "canEditTemplate": true,
  "path": "/NIDAP/NCI-Wide Analysis & Visualization Resources/SPAC/SPAC Templates/Summarize Annotation's Statistics [SPAC] [DMAP]",
  "tags": [
    {
      "rid": "ri.compass.main.tag.02094a7d-d869-4dff-bc31-78ad8676d1ad",
      "name": "Code Templates:DMAP"
    },
    {
      "rid": "ri.compass.main.tag.ebb2ab0f-e354-4bd4-9f3a-e78dc8452986",
      "name": "Code Templates:SPAC"
    }
  ],
  "favorite": false,
  "namedCollections": [],
  "isDefault": true,
  "condaDependencies": [
    "python=3.6"
  ],
  "outputDatasetName": "annotation_summaries",
  "outputs": {
    "dataframe": {"type": "file", "name": "dataframe.csv"}
  }
}