

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>spac.utils module &mdash; spac  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=b3ba4146"></script>
      <script src="../_static/doctools.js?v=888ff710"></script>
      <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="spac.visualization module" href="spac.visualization.html" />
    <link rel="prev" title="spac.utag_functions module" href="spac.utag_functions.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            spac
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">spac modules</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="spac.data_utils.html">spac.data_utils module</a></li>
<li class="toctree-l2"><a class="reference internal" href="spac.phenotyping.html">spac.phenotyping module</a></li>
<li class="toctree-l2"><a class="reference internal" href="spac.spatial_analysis.html">spac.spatial_analysis module</a></li>
<li class="toctree-l2"><a class="reference internal" href="spac.transformations.html">spac.transformations module</a></li>
<li class="toctree-l2"><a class="reference internal" href="spac.utag_functions.html">spac.utag_functions module</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">spac.utils module</a></li>
<li class="toctree-l2"><a class="reference internal" href="spac.visualization.html">spac.visualization module</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">spac</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">spac modules</a></li>
      <li class="breadcrumb-item active">spac.utils module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/modules/spac.utils.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-spac.utils">
<span id="spac-utils-module"></span><h1>spac.utils module<a class="headerlink" href="#module-spac.utils" title="Permalink to this heading"></a></h1>
<dl class="py function">
<dt class="sig sig-object py" id="spac.utils.annotation_category_relations">
<span class="sig-prename descclassname"><span class="pre">spac.utils.</span></span><span class="sig-name descname"><span class="pre">annotation_category_relations</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">source_annotation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_annotation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spac/utils.html#annotation_category_relations"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#spac.utils.annotation_category_relations" title="Permalink to this definition"></a></dt>
<dd><p>Calculates the count of unique relationships between two
annotations in an AnnData object.
Relationship is defined as a unique pair of values, one from the
‘source_annotation’ and one from the ‘target_annotation’.</p>
<p>Returns a DataFrame with columns ‘source_annotation’, ‘target_annotation’,
‘count’, ‘percentage_source’, and ‘percentage_target’.
Where ‘count’ represents the number of occurrences of each relationship,
percentage_source represents the percentage of the count of link
over the total count of the source label, and percentage_target represents
the percentage of the count of link over the total count of the target.</p>
<p>If the <cite>prefix</cite> is set to True, it appends “<a href="#id1"><span class="problematic" id="id2">source_</span></a>” and “<a href="#id3"><span class="problematic" id="id4">target_</span></a>”
prefixes to labels in the “source” and “target” columns, respectively.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> (<em>AnnData</em>) – The annotated data matrix of shape <cite>n_obs</cite> * <cite>n_vars</cite>.
Rows correspond to cells and columns to genes.</p></li>
<li><p><strong>source_annotation</strong> (<em>str</em>) – The name of the source annotation column in the <cite>adata</cite> object.</p></li>
<li><p><strong>target_annotation</strong> (<em>str</em>) – The name of the target annotation column in the <cite>adata</cite> object.</p></li>
<li><p><strong>prefix</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, appends “<a href="#id5"><span class="problematic" id="id6">source_</span></a>” and “<a href="#id7"><span class="problematic" id="id8">target_</span></a>” prefixes to the
“source” and “target” columns, respectively.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>relationships</strong> – A DataFrame with the source and target categories,
their counts and their percentages.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pandas.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="spac.utils.check_annotation">
<span class="sig-prename descclassname"><span class="pre">spac.utils.</span></span><span class="sig-name descname"><span class="pre">check_annotation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">annotations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parameter_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">should_exist</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spac/utils.html#check_annotation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#spac.utils.check_annotation" title="Permalink to this definition"></a></dt>
<dd><p>Perform common error checks for annotations in
anndata related objects.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> (<em>anndata.AnnData</em>) – The AnnData object to be checked.</p></li>
<li><p><strong>annotations</strong> (<em>str</em><em> or </em><em>list</em><em> of </em><em>str</em><em>, </em><em>optional</em>) – The annotation(s) to check for existence in adata.obs.</p></li>
<li><p><strong>should_exist</strong> (<em>bool</em><em>, </em><em>optional</em><em> (</em><em>default=True</em><em>)</em>) – Determines whether to check if elements exist in the
target list (True), or if they should not exist (False).</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>TypeError</strong> – If adata is not an instance of anndata.AnnData.</p></li>
<li><p><strong>ValueError</strong> – If any of the specified layers, annotations, or features do not exist.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="spac.utils.check_column_name">
<span class="sig-prename descclassname"><span class="pre">spac.utils.</span></span><span class="sig-name descname"><span class="pre">check_column_name</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">column_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">field_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">symbol_checklist</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'!?,.'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spac/utils.html#check_column_name"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#spac.utils.check_column_name" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="spac.utils.check_distances">
<span class="sig-prename descclassname"><span class="pre">spac.utils.</span></span><span class="sig-name descname"><span class="pre">check_distances</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">distances</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spac/utils.html#check_distances"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#spac.utils.check_distances" title="Permalink to this definition"></a></dt>
<dd><p>Check that the distances are valid: must be an array-like of
incremental positive values.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>distances</strong> (<em>list</em><em>, </em><em>tuple</em><em>, or </em><em>np.ndarray</em>) – The list of increasing distances for the neighborhood profile.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Raises a ValueError or TypeError if the distances are invalid.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The distances must be a list of positive real numbers and must
be monotonically increasing.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="spac.utils.check_feature">
<span class="sig-prename descclassname"><span class="pre">spac.utils.</span></span><span class="sig-name descname"><span class="pre">check_feature</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">features</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">should_exist</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spac/utils.html#check_feature"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#spac.utils.check_feature" title="Permalink to this definition"></a></dt>
<dd><p>Perform common error checks for features in
anndata related objects.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> (<em>anndata.AnnData</em>) – The AnnData object to be checked.</p></li>
<li><p><strong>features</strong> (<em>str</em><em> or </em><em>list</em><em> of </em><em>str</em><em>, </em><em>optional</em>) – The feature(s) to check for existence in adata.var_names.</p></li>
<li><p><strong>should_exist</strong> (<em>bool</em><em>, </em><em>optional</em><em> (</em><em>default=True</em><em>)</em>) – Determines whether to check if elements exist in the
target list (True), or if they should not exist (False).</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>TypeError</strong> – If adata is not an instance of anndata.AnnData.</p></li>
<li><p><strong>ValueError</strong> – If any of the specified layers, annotations, or features do not exist.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="spac.utils.check_label">
<span class="sig-prename descclassname"><span class="pre">spac.utils.</span></span><span class="sig-name descname"><span class="pre">check_label</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">annotation</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">should_exist</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">warning</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spac/utils.html#check_label"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#spac.utils.check_label" title="Permalink to this definition"></a></dt>
<dd><p>Check if specified labels exist in a given annotation column in adata.obs.</p>
<p>This function verifies whether all or none of the specified labels
exist in the provided annotation column of an AnnData object. It ensures
that the input labels align with the expected categories present in
adata.obs[annotation].</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> (<em>anndata.AnnData</em>) – The AnnData object containing the annotation column.</p></li>
<li><p><strong>annotation</strong> (<em>str</em>) – The name of the annotation column in adata.obs to check against.</p></li>
<li><p><strong>labels</strong> (<em>str</em><em> or </em><em>list</em><em> of </em><em>str</em><em>, </em><em>optional</em>) – The label or list of labels to check for existence in the specified
annotation column. If None, no validation will be performed.</p></li>
<li><p><strong>should_exist</strong> (<em>bool</em><em>, </em><em>optional</em><em> (</em><em>default=True</em><em>)</em>) – Determines whether to check if elements exist in the target column
(True), or if they should not exist (False).</p></li>
<li><p><strong>warning</strong> (<em>bool</em><em>, </em><em>optional</em><em> (</em><em>default=False</em><em>)</em>) – If True, generate a warning instead of raising an exception if the
specified condition is not met.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>TypeError</strong> – If adata is not an instance of anndata.AnnData.</p></li>
<li><p><strong>ValueError</strong> – If the specified annotation does not exist in adata.obs.
    If should_exist is True and any label does not exist in the
    annotation column.
    If should_exist is False and any label already exists in the
    annotation column.</p></li>
</ul>
</dd>
<dt class="field-odd">Warns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>UserWarning</strong> – If the specified condition is not met and warning is True.</p>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">check_label</span><span class="p">(</span><span class="n">adata</span><span class="p">,</span> <span class="s2">&quot;cell_type&quot;</span><span class="p">,</span> <span class="s2">&quot;B_cell&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">check_label</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">adata</span><span class="p">,</span> <span class="s2">&quot;cluster&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Cluster1&quot;</span><span class="p">,</span> <span class="s2">&quot;Cluster2&quot;</span><span class="p">],</span> <span class="n">should_exist</span><span class="o">=</span><span class="kc">True</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="spac.utils.check_list_in_list">
<span class="sig-prename descclassname"><span class="pre">spac.utils.</span></span><span class="sig-name descname"><span class="pre">check_list_in_list</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">input_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">need_exist</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">warning</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spac/utils.html#check_list_in_list"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#spac.utils.check_list_in_list" title="Permalink to this definition"></a></dt>
<dd><p>Check if items in a given list exist in a target list.</p>
<p>This function is used to validate whether all or none of the
items in a given list exist in a target list.
It helps to ensure that the input list contains only valid elements
that are present in the target list.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input</strong> (<em>str</em><em> or </em><em>list</em><em> of </em><em>str</em><em> or </em><em>None</em>) – The input list or a single string element. If it is a string,
it will be converted to a list containing
only that string element. If <cite>None</cite>, no validation will be performed.</p></li>
<li><p><strong>input_name</strong> (<em>str</em>) – The name of the input list used for displaying helpful error messages.</p></li>
<li><p><strong>input_type</strong> (<em>str</em>) – The type of items in the input list
(e.g., “item”, “element”, “category”).</p></li>
<li><p><strong>target_list</strong> (<em>list</em><em> of </em><em>str</em>) – The target list containing valid items that the input list elements
should be compared against.</p></li>
<li><p><strong>need_exist</strong> (<em>bool</em><em>, </em><em>optional</em><em> (</em><em>default=True</em><em>)</em>) – <dl class="simple">
<dt>Determines whether to check if elements exist in the</dt><dd><p>target list (True), or if they should not exist (False).</p>
</dd>
<dt>warning: bool, optional (default=False)</dt><dd><p>If true, generate a warning instead of raising an exception</p>
</dd>
</dl>
</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If the <cite>input</cite> is not a string or a list of strings.
    If <cite>need_exist</cite> is True and any element of the input
        list does not exist in the target list.
    If <cite>need_exist</cite> is False and any element of the input
        list exists in the target list.</p>
</dd>
<dt class="field-odd">Warns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>UserWarning</strong> – If the specified behavior is not present
and <cite>warning</cite> is True.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="spac.utils.check_table">
<span class="sig-prename descclassname"><span class="pre">spac.utils.</span></span><span class="sig-name descname"><span class="pre">check_table</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tables</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">should_exist</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">associated_table</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">warning</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spac/utils.html#check_table"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#spac.utils.check_table" title="Permalink to this definition"></a></dt>
<dd><p>Perform common error checks for table (layers) or derived tables (obsm) in
anndata related objects.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> (<em>anndata.AnnData</em>) – The AnnData object to be checked.</p></li>
<li><p><strong>tables</strong> (<em>str</em><em> or </em><em>list</em><em> of </em><em>str</em><em>, </em><em>optional</em>) – The term “table” is equivalent to layer in anndata structure.
The layer(s) to check for existence in adata.layers.keys().</p></li>
<li><p><strong>should_exist</strong> (<em>bool</em><em>, </em><em>optional</em><em> (</em><em>default=True</em><em>)</em>) – Determines whether to check if elements exist in the
target list (True), or if they should not exist (False).</p></li>
<li><p><strong>associtated_table</strong> (<em>bool</em><em>, </em><em>optional</em><em> (</em><em>default=False</em><em>)</em>) – Determines whether to check if the passed tables names
should exist as layers or in obsm in the andata object.</p></li>
<li><p><strong>warning</strong> (<em>bool</em><em>, </em><em>optional</em><em> (</em><em>default=False</em><em>)</em>) – If True, generate a warning instead of raising an exception.</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>TypeError</strong> – If adata is not an instance of anndata.AnnData.</p></li>
<li><p><strong>ValueError</strong> – If any of the specified layers, annotations, obsm,
    or features do not exist.</p></li>
</ul>
</dd>
<dt class="field-odd">Warns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>UserWarning</strong> – If any of the specified layers, annotations, obsm,
or features do not exist, and <cite>warning</cite> is True.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="spac.utils.color_mapping">
<span class="sig-prename descclassname"><span class="pre">spac.utils.</span></span><span class="sig-name descname"><span class="pre">color_mapping</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">labels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">color_map</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'viridis'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">opacity</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rgba_mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_dict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spac/utils.html#color_mapping"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#spac.utils.color_mapping" title="Permalink to this definition"></a></dt>
<dd><p>Map a list of labels to colors using a Matplotlib colormap and opacity.</p>
<p>This function assigns a unique color to each label in the provided list
using a specified colormap from Matplotlib. The generated colors can be
returned in either <cite>rgba</cite> or <cite>rgb</cite> format, suitable for visualization in
libraries like Plotly.</p>
<p>The function supports both continuous and discrete colormaps:
- Continuous colormaps interpolate smoothly between colors across a range.
- Discrete colormaps have a fixed number of distinct colors, and labels are</p>
<blockquote>
<div><p>distributed evenly across these colors.</p>
</div></blockquote>
<p>Opacity can be set with a value between 0 (fully transparent) and 1 (fully
opaque). The resulting colors are CSS-compatible strings.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>labels</strong> (<em>list</em>) – A list of unique labels to map to colors. The number of labels
determines how the colormap is sampled.</p></li>
<li><p><strong>color_map</strong> (<em>str</em><em>, </em><em>optional</em>) – The colormap name (e.g., ‘viridis’, ‘plasma’, ‘inferno’). It must be a
valid Matplotlib colormap. Default is ‘viridis’.</p></li>
<li><p><strong>opacity</strong> (<em>float</em><em>, </em><em>optional</em>) – Opacity (alpha channel) for colors, between 0 (transparent) and 1
(opaque). Default is 1.0.</p></li>
<li><p><strong>rgba_mode</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, returns colors in <cite>rgba</cite> format (e.g., <cite>rgba(255, 0, 0, 0.5)</cite>).
If False, returns <cite>rgb</cite> format (e.g., <cite>rgb(255, 0, 0)</cite>).
Default is True.</p></li>
<li><p><strong>return_dict</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, returns a dictionary where keys are labels, and values are the
corresponding colors. Default is False.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>label_colors</strong> – If <cite>return_dict</cite> is False, returns a list of color strings, one for
each label. If <cite>return_dict</cite> is True, returns a dictionary with label
keys and color values. The format of the colors depends on the
<cite>rgba_mode</cite> parameter.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list[str] or dict</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – <ul class="simple">
<li><p>If <cite>opacity</cite> is not in the range [0, 1].
    - If <cite>color_map</cite> is not a valid Matplotlib colormap name.</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Assign colors to labels with default settings:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">color_mapping</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
<span class="go">[&#39;rgba(68, 1, 84, 1.0)&#39;, &#39;rgba(58, 82, 139, 1.0)&#39;,</span>
<span class="go"> &#39;rgba(33, 145, 140, 1.0)&#39;]</span>
</pre></div>
</div>
<p>Use a different colormap with reduced opacity:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">color_mapping</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">color_map</span><span class="o">=</span><span class="s1">&#39;plasma&#39;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="go">[&#39;rgba(13, 8, 135, 0.5)&#39;, &#39;rgba(126, 3, 167, 0.5)&#39;,</span>
<span class="go"> &#39;rgba(240, 249, 33, 0.5)&#39;]</span>
</pre></div>
</div>
<p>Generate colors in <cite>rgb</cite> format:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">color_mapping</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">rgba_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="go">[&#39;rgb(68, 1, 84)&#39;, &#39;rgb(58, 82, 139)&#39;, &#39;rgb(33, 145, 140)&#39;]</span>
</pre></div>
</div>
<p>Return a dictionary of labels and colors:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">color_mapping</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">{&#39;A&#39;: &#39;rgba(68, 1, 84, 1.0)&#39;, &#39;B&#39;: &#39;rgba(58, 82, 139, 1.0)&#39;,</span>
<span class="go"> &#39;C&#39;: &#39;rgba(33, 145, 140, 1.0)&#39;}</span>
</pre></div>
</div>
<p class="rubric">Notes</p>
<ul class="simple">
<li><p>Continuous colormaps interpolate colors evenly based on the number of
labels.</p></li>
<li><p>Discrete colormaps divide labels evenly across available colors.</p></li>
<li><p>For more information on Matplotlib colormaps:
<a class="reference external" href="https://matplotlib.org/stable/users/explain/colors/colormaps.html">https://matplotlib.org/stable/users/explain/colors/colormaps.html</a></p></li>
</ul>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="spac.utils.compute_boxplot_metrics">
<span class="sig-prename descclassname"><span class="pre">spac.utils.</span></span><span class="sig-name descname"><span class="pre">compute_boxplot_metrics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataFrame</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">annotation</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">showfliers</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spac/utils.html#compute_boxplot_metrics"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#spac.utils.compute_boxplot_metrics" title="Permalink to this definition"></a></dt>
<dd><p>Compute boxplot-related statistical metrics for a given dataset
efficiently.</p>
<dl class="simple">
<dt>Statistics include:</dt><dd><ul class="simple">
<li><p>Lower and upper whiskers (<cite>whislo</cite>, <cite>whishi</cite>),</p></li>
<li><p>First quartile (<cite>q1</cite>),</p></li>
<li><p>Median (<cite>median</cite>),</p></li>
<li><p>Third quartile (<cite>q3</cite>),</p></li>
<li><p>Mean (<cite>mean</cite>)</p></li>
<li><p>Outliers (<cite>fliers</cite>) [If <cite>showfliers</cite> is not None]</p></li>
</ul>
</dd>
</dl>
<p>It can identify outliers based on the ‘showfliers’ parameter, and
supports efficient handling of large datasets by downsampling outliers
when specified.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> (<em>pd.DataFrame</em>) – A pandas DataFrame containing the numerical data for which
the boxplot statistics are to be computed.</p></li>
<li><p><strong>annotation</strong> (<em>str</em><em>, </em><em>optional:</em>) – The annotation used to group the features</p></li>
<li><p><strong>showfliers</strong> (<em>{None</em><em>, </em><em>&quot;downsample&quot;</em><em>, </em><em>&quot;all&quot;}</em><em>, </em><em>default = None</em>) – Defines how outliers are handled
If ‘all’, all outliers are displayed in the boxplot.
If ‘downsample’, when num outliers is &gt;10k, they are downsampled to
10% of the original count.
If None, outliers are hidden.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>metrics</strong> – A dataframe with one row per feature/annotation grouping and
columns representing the calculated features</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>pd.DataFrame</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="spac.utils.get_defined_color_map">
<span class="sig-prename descclassname"><span class="pre">spac.utils.</span></span><span class="sig-name descname"><span class="pre">get_defined_color_map</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">adata</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">defined_color_map</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">annotations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">colorscale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'viridis'</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spac/utils.html#get_defined_color_map"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#spac.utils.get_defined_color_map" title="Permalink to this definition"></a></dt>
<dd><p>Retrieve or generate a predefined color mapping dictionary from an AnnData
object.</p>
<p>If <cite>defined_color_map</cite> is provided and found within <cite>adata.uns</cite>, the
corresponding dictionary is returned. Otherwise, if it is not provided, a
color mapping is generated using the unique values of the annotation column
specified by <cite>annotations</cite> and the given <cite>colorscale</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>adata</strong> (<em>anndata.AnnData</em>) – Annotated data matrix object that should contain a color mapping in its
<cite>uns</cite> attribute if a predefined mapping is desired.</p></li>
<li><p><strong>defined_color_map</strong> (<em>str</em><em>, </em><em>optional</em>) – The key in <cite>adata.uns</cite> that holds the predefined color mapping.
If None, a new mapping is generated using <cite>annotations</cite>.</p></li>
<li><p><strong>annotations</strong> (<em>str</em><em>, </em><em>optional</em>) – The annotation column name in adata.obs from which to obtain unique
labels if <cite>defined_color_map</cite> is not provided.</p></li>
<li><p><strong>colorscale</strong> (<em>str</em><em>, </em><em>optional</em>) – The Matplotlib colormap name to use when generating a color mapping if
<cite>defined_color_map</cite> is not provided. Default is ‘viridis’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary mapping unique labels to colors.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>TypeError</strong> – If <cite>defined_color_map</cite> is provided but is not a string.</p></li>
<li><p><strong>ValueError</strong> – If a predefined mapping is requested but not found, or if neither
    <cite>defined_color_map</cite> nor <cite>annotations</cite> is provided.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="spac.utils.regex_search_list">
<span class="sig-prename descclassname"><span class="pre">spac.utils.</span></span><span class="sig-name descname"><span class="pre">regex_search_list</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">regex_patterns</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">list_to_search</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spac/utils.html#regex_search_list"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#spac.utils.regex_search_list" title="Permalink to this definition"></a></dt>
<dd><p>Perfrom regex (regular expression) search in a list and
return list of strings matching the regex pattern</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>regex_pattern</strong> (<em>str</em><em> or </em><em>a list</em><em> of </em><em>str</em>) – The regex pattern to look for,
single pattern or a list of patterns.</p></li>
<li><p><strong>list_to_search</strong> (<em>list</em><em> of </em><em>str</em>) – A list of string to seach for string that matches regex pattern.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A list of strings containing results from search.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>list of str</p>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">regex_pattern</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;^B.*&quot;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">list_to_search</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ABC&quot;</span><span class="p">,</span> <span class="s2">&quot;BC&quot;</span><span class="p">,</span> <span class="s2">&quot;AC&quot;</span><span class="p">,</span> <span class="s2">&quot;AB&quot;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">regex_search_list</span><span class="p">(</span><span class="n">regex_pattern</span><span class="p">,</span> <span class="n">list_to_search</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">[&#39;BC&#39;]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="spac.utils.spell_out_special_characters">
<span class="sig-prename descclassname"><span class="pre">spac.utils.</span></span><span class="sig-name descname"><span class="pre">spell_out_special_characters</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">text</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spac/utils.html#spell_out_special_characters"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#spac.utils.spell_out_special_characters" title="Permalink to this definition"></a></dt>
<dd><p>Convert special characters in a string to comply with NIDAP naming rules.</p>
<p>This function processes a string by replacing or removing disallowed
characters to ensure compatibility with NIDAP. Spaces, special symbols,
and certain substrings are replaced or transformed into readable and
regulation-compliant equivalents.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>text</strong> (<em>str</em>) – The input string to be processed and converted.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><em>str</em> – A sanitized string with special characters replaced or removed,
adhering to NIDAP naming conventions.</p></li>
<li><p><em>Processing Steps</em></p></li>
<li><p><em>—————-</em></p></li>
<li><ol class="arabic simple">
<li><p>Spaces are replaced with underscores (<cite>_</cite>).</p></li>
</ol>
</li>
<li><p><em>2. Substrings related to units (e.g., ‘µm²’) are replaced with text</em> – equivalents:
- ‘µm²’ -&gt; ‘um2’
- ‘µm’ -&gt; ‘um’</p></li>
<li><ol class="arabic simple" start="3">
<li><p>Hyphens (<cite>-</cite>) between letters are replaced with underscores (<cite>_</cite>).</p></li>
</ol>
</li>
<li><p><em>4. Certain special symbols are mapped to readable equivalents</em> –</p>
<ul>
<li><p><cite>+</cite> -&gt; <cite>_pos_</cite></p></li>
<li><p><cite>-</cite> -&gt; <cite>_neg_</cite></p></li>
<li><p><cite>&#64;</cite> -&gt; <cite>at</cite></p></li>
<li><p><cite>#</cite> -&gt; <cite>hash</cite></p></li>
<li><p><cite>&amp;</cite> -&gt; <cite>and</cite></p></li>
<li><p>And more (see Notes section for a full mapping).</p></li>
</ul>
</li>
<li><p><em>5. Remaining disallowed characters are removed (non-alphanumeric and</em> – non-underscore characters).</p></li>
<li><p><em>6. Consecutive underscores are consolidated into a single underscore.</em></p></li>
<li><p><em>7. Leading and trailing underscores are stripped.</em></p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The following special character mappings are used:
- <cite>µ</cite> -&gt; <cite>u</cite>
- <cite>²</cite> -&gt; <cite>2</cite>
- <cite>/</cite> -&gt; <cite>slash</cite>
- <cite>=</cite> -&gt; <cite>equals</cite>
- <cite>!</cite> -&gt; <cite>exclamation</cite>
- <cite>|</cite> -&gt; <cite>pipe</cite>
- For a complete list, refer to the <cite>special_char_map</cite> in the code.</p>
<p class="rubric">Example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">spell_out_special_characters</span><span class="p">(</span><span class="s2">&quot;Data µm²+Analysis #1-2&quot;</span><span class="p">)</span>
<span class="go">&#39;Data_um2_pos_Analysis_hash1_neg_2&#39;</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">spell_out_special_characters</span><span class="p">(</span><span class="s2">&quot;Invalid!Char@Format&quot;</span><span class="p">)</span>
<span class="go">&#39;Invalid_exclamation_Char_at_Format&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="spac.utils.text_to_others">
<span class="sig-prename descclassname"><span class="pre">spac.utils.</span></span><span class="sig-name descname"><span class="pre">text_to_others</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parameter</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">text</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'None'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">to_None</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">to_False</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">to_True</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">to_Int</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">to_Float</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/spac/utils.html#text_to_others"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#spac.utils.text_to_others" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="spac.utag_functions.html" class="btn btn-neutral float-left" title="spac.utag_functions module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="spac.visualization.html" class="btn btn-neutral float-right" title="spac.visualization module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Fang Liu, Rui He, and George Zaki.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>